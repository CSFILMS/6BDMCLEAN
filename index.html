<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PRICEOFTRUTH</title>
    <!-- Cache bust: fadelong-video-fix-v1 -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <style>
    /* 
     * MOBILE STABILITY NOTICE:
     * This video system has been optimized for mobile stability.
     * Code marked with "MOBILE STABILITY ZONE - DO NOT MODIFY" 
     * should NEVER be changed as it ensures consistent mobile behavior.
     * Desktop improvements should be made outside these zones.
     */
    
    /* Video container - fullscreen edge to edge */
    .video-container {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      right: 0 !important;
      bottom: 0 !important;
      width: 100vw !important;
      height: 100vh !important;
      z-index: 2147483647 !important;
      pointer-events: none !important;
      display: none;
      overflow: visible !important;
    }
    
    /* Desktop - align video left edge with "A FILM BY" text */
    @media (min-width: 769px) {
      .video-container {
        left: calc(42% - 35vh) !important;
        width: calc(100vw - (42% - 35vh)) !important;
      }
      
      /* Slide 7 trailer - centered and lifted up */
      body.video-slide-active.trailer-slide .video-container {
        left: 50% !important;
        right: auto !important;
        top: 15vh !important;
        bottom: auto !important;
        width: 90vw !important;
        transform: translateX(-50%) !important;
        display: flex !important;
        align-items: flex-start !important;
        justify-content: center !important;
        height: auto !important;
      }
      
      body.video-slide-active.trailer-slide .bg-video {
        position: relative !important;
        max-width: 100% !important;
        max-height: 85vh !important;
        pointer-events: auto !important;
      }
    }
    
    /* Background video - inside container with contain (for trailer) */
    .bg-video.bg-video3 {
      position: absolute !important;
      top: 0 !important;
      left: 0 !important;
      width: 100% !important;
      height: 100% !important;
      object-fit: contain !important;
      object-position: center 30% !important;
      pointer-events: none !important;
      display: block !important;
      animation: none;
      border: none !important;
      margin: 0 !important;
      padding: 0 !important;
      box-sizing: border-box !important;
    }
    
    /* FADELONG video - EXACT V3 PATTERN (position: fixed, no container) */
    #bg-video-fadelong {
      position: fixed !important;
      top: 50% !important;
      left: 60% !important;
      transform: translate(-50%, -50%) scaleX(0.8) !important;
      width: calc(50vw - 2rem) !important;
      height: calc(60vh - 2rem) !important;
      object-fit: cover !important;
      object-position: center center !important;
      z-index: 0 !important; /* Changed from -1 to 0 so it's above background but below content */
      pointer-events: none !important;
      display: none;
      filter: grayscale(1) brightness(0.64) contrast(1.2) sepia(1) hue-rotate(60deg) saturate(2) !important;
      animation: videoFlicker 0.06s steps(1, end) infinite, hologramRoll 3s linear infinite, hologramGlitch 0.8s infinite !important;
      overflow: hidden !important;
    }
    
    /* Mobile video - 15% bigger (V3 pattern) */
    @media (max-width: 768px) {
      #bg-video-fadelong {
        width: calc(57.5vw - 2rem); /* 50vw * 1.15 = 57.5vw */
        height: calc(69vh - 2rem);  /* 60vh * 1.15 = 69vh */
      }
    }
    
    /* Add hologram container for better effect control (V3 pattern) */
    #bg-video-fadelong::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(
        0deg,
        transparent 0%,
        rgba(0, 255, 0, 0.1) 25%,
        rgba(0, 255, 0, 0.2) 50%,
        rgba(0, 255, 0, 0.1) 75%,
        transparent 100%
      );
      animation: verticalRoll 2s linear infinite;
      pointer-events: none;
      z-index: 1;
    }
    
    /* Video flicker animation (V3 pattern) */
    @keyframes videoFlicker {
      0% { filter: grayscale(1) brightness(0.64) contrast(1.2) sepia(1) hue-rotate(60deg) saturate(2); }
      8% { filter: grayscale(1) brightness(0.58) contrast(1.25) sepia(1) hue-rotate(59deg) saturate(2.1); }
      15% { filter: grayscale(1) brightness(0.71) contrast(1.15) sepia(1) hue-rotate(61deg) saturate(1.9); }
      23% { filter: grayscale(1) brightness(0.55) contrast(1.28) sepia(1) hue-rotate(58deg) saturate(2.2); }
      31% { filter: grayscale(1) brightness(0.68) contrast(1.18) sepia(1) hue-rotate(62deg) saturate(1.8); }
      38% { filter: grayscale(1) brightness(0.61) contrast(1.22) sepia(1) hue-rotate(60deg) saturate(2.0); }
      46% { filter: grayscale(1) brightness(0.73) contrast(1.16) sepia(1) hue-rotate(61deg) saturate(1.9); }
      54% { filter: grayscale(1) brightness(0.57) contrast(1.26) sepia(1) hue-rotate(59deg) saturate(2.1); }
      62% { filter: grayscale(1) brightness(0.66) contrast(1.19) sepia(1) hue-rotate(60deg) saturate(2.0); }
      69% { filter: grayscale(1) brightness(0.59) contrast(1.24) sepia(1) hue-rotate(58deg) saturate(2.2); }
      77% { filter: grayscale(1) brightness(0.72) contrast(1.17) sepia(1) hue-rotate(62deg) saturate(1.8); }
      85% { filter: grayscale(1) brightness(0.62) contrast(1.21) sepia(1) hue-rotate(60deg) saturate(2.0); }
      92% { filter: grayscale(1) brightness(0.67) contrast(1.18) sepia(1) hue-rotate(61deg) saturate(1.9); }
      100% { filter: grayscale(1) brightness(0.64) contrast(1.2) sepia(1) hue-rotate(60deg) saturate(2); }
    }
    
    /* Vertical roll displacement effect (V3 pattern) */
    @keyframes verticalRoll {
      0% { transform: translateY(-100%); }
      100% { transform: translateY(100%); }
    }
    
    /* Hologram rolling wave effect (V3 pattern) */
    @keyframes hologramRoll {
      0% { 
        transform: translate(-50%, -50%) scaleX(0.8) scaleY(1);
        filter: grayscale(1) brightness(0.64) contrast(1.2) sepia(1) hue-rotate(60deg) saturate(2);
      }
      25% { 
        transform: translate(-50%, -50%) scaleX(0.8) scaleY(1.02);
        filter: grayscale(1) brightness(0.68) contrast(1.15) sepia(1) hue-rotate(62deg) saturate(2.1);
      }
      50% { 
        transform: translate(-50%, -50%) scaleX(0.8) scaleY(0.98);
        filter: grayscale(1) brightness(0.6) contrast(1.25) sepia(1) hue-rotate(58deg) saturate(1.9);
      }
      75% { 
        transform: translate(-50%, -50%) scaleX(0.8) scaleY(1.01);
        filter: grayscale(1) brightness(0.66) contrast(1.18) sepia(1) hue-rotate(61deg) saturate(2.05);
      }
      100% { 
        transform: translate(-50%, -50%) scaleX(0.8) scaleY(1);
        filter: grayscale(1) brightness(0.64) contrast(1.2) sepia(1) hue-rotate(60deg) saturate(2);
      }
    }
    
    /* Hologram glitch effect (V3 pattern) */
    @keyframes hologramGlitch {
      0%, 90%, 100% { 
        transform: translate(-50%, -50%) scaleX(0.8);
        opacity: 1;
      }
      92% { 
        transform: translate(-50.1%, -50%) scaleX(0.8);
        opacity: 0.95;
      }
      94% { 
        transform: translate(-49.9%, -50.05%) scaleX(0.8);
        opacity: 0.98;
      }
      96% { 
        transform: translate(-50.05%, -49.95%) scaleX(0.8);
        opacity: 0.96;
      }
      98% { 
        transform: translate(-49.95%, -50%) scaleX(0.8);
        opacity: 0.97;
      }
    }
    
    /* Mobile - balanced fullscreen, left-aligned */
    @media (max-width: 768px) {
      .video-container {
        width: 100vw !important;
        height: 100vh !important;
        left: 0 !important;
        right: 0 !important;
        padding: 0 !important;
        margin: 0 !important;
        transform: none !important;
      }
      
      .bg-video {
        object-fit: contain !important;
        object-position: 0% center !important;
        width: 100% !important;
        height: 100% !important;
        left: 0 !important;
        margin-left: -15% !important;
        padding: 0 !important;
        transform: none !important;
        position: absolute !important;
      }
      
      /* Slide 7 trailer - centered and lifted up on mobile */
      body.video-slide-active.trailer-slide .video-container {
        left: 50% !important;
        top: 15vh !important;
        bottom: auto !important;
        transform: translateX(-50%) !important;
        display: flex !important;
        align-items: flex-start !important;
        justify-content: center !important;
        height: auto !important;
      }
      
      body.video-slide-active.trailer-slide .bg-video {
        position: relative !important;
        max-width: 95vw !important;
        max-height: 85vh !important;
        margin-left: 0 !important;
        pointer-events: auto !important;
      }
    }
    
    /* Video text overlay */
    #video-text-overlay {
      position: fixed;
      top: calc(40% - 30vh); /* Position at top-left of smaller video area - higher */
      left: calc(42% - 35vh); /* Position at top-left of smaller video area */
      z-index: 2147483648 !important;
      color: var(--fg);
      font-family: var(--font-family);
      font-size: 1.05rem;
      text-align: left;
      padding: 0.7rem 1.05rem;
      pointer-events: none;
      white-space: pre-wrap;
      text-shadow: 0 0 3px var(--fg), 0 0 10px var(--fg), 0 0 20px var(--fg);
      background-color: transparent; /* Remove black background */
    }
    
    /* Mobile video text overlay - positioned for contained video */
    @media (max-width: 768px) {
      #video-text-overlay {
        top: 20% !important;
        left: 10% !important;
        right: 10% !important;
        transform: none !important;
        text-align: left !important;
        font-size: 1.1rem !important;
        max-width: 80% !important;
      }
    }
    
    /* Scanline patch over video text */
    #video-text-scanlines {
      position: fixed;
      top: calc(40% - 30vh + 0.7rem); /* Match text position with padding offset */
      left: calc(42% - 35vh + 0.7rem); /* Match text position with padding offset */
      width: 25rem;
      height: 3rem;
      z-index: 2147483649 !important;
      pointer-events: none;
      background-image: repeating-linear-gradient(
        to bottom,
        rgba(0, 0, 0, 0.3) 0px,
        rgba(0, 0, 0, 0.3) 3px,
        transparent 3px,
        transparent 6px
      );
      display: none;
      /* Create clipping mask using mix-blend-mode */
      mix-blend-mode: multiply;
      opacity: 0.8;
    }
    
    /* Mobile scanlines - positioned for contained video */
    @media (max-width: 768px) {
      #video-text-scanlines {
        top: calc(20% + 0.7rem) !important;
        left: 10% !important;
        right: 10% !important;
        transform: none !important;
        width: 80% !important;
        height: 2.5rem !important;
      }
    }
    
    /* Scanline patch over navbar */
    #nav-scanlines {
      position: fixed;
      bottom: 15vh;
        left: 50%;
      transform: translateX(-50%);
      width: 30rem;
      height: 7vh;
      z-index: 2147483650;
      pointer-events: none;
      background-image: repeating-linear-gradient(
        to bottom,
        rgba(0, 0, 0, 0.3) 0px,
        rgba(0, 0, 0, 0.3) 3px,
        transparent 3px,
        transparent 6px
      );
    }
    
    /* Video text scanlines removed */
    
    @media (max-width: 768px) {
      #video-text-overlay {
        font-size: 0.84rem;
        top: 1.5rem !important;
        left: 1.5rem !important;
        transform: none !important;
        padding: 0.52rem 0.7rem;
      }
      
      #video-text-scanlines {
        top: 1.5rem !important;
        left: 2rem !important;
        transform: none !important;
      }
      
      #video-end-subtitle {
        top: auto !important;
        left: 2rem !important;
        bottom: 25vh !important;
        transform: none !important;
      }
      
      /* Mobile image positioning and sizing */
      #cannes-photo-container,
      #arrest-photo-container,
      #correa-photo-container {
        max-width: 60vw !important;
        max-height: 28vh !important;
        width: 60vw !important;
        bottom: 25vh !important; /* Move up from 20vh */
      }
      
      #collateral-photo-container {
        max-width: 75vw !important;
        max-height: 35vh !important;
        width: 75vw !important;
        bottom: 22vh !important; /* Move up from 18vh */
      }
      
      /* Mobile video slide UI adjustments */
      #nav {
        bottom: 12vh; /* Move up slightly on mobile */
        z-index: 2147483648 !important;
        font-size: 0.8rem;
        padding: 0.5rem 1rem;
      }
      
      #slide-counter {
        bottom: 6vh; /* Move up slightly on mobile */
        z-index: 2147483649 !important;
        font-size: 0.6rem;
      }
      
      #nav-scanlines {
        bottom: 12vh; /* Match navbar position */
        z-index: 2147483650 !important;
        width: 25rem; /* Slightly smaller on mobile */
      }
    }
    
    /* Desktop body reset to ensure no padding/margin interference */
    @media (min-width: 769px) {
      body {
        padding: 0 !important;
        margin: 0 !important;
        overflow: hidden;
      }
    }
    
    /* Hologram overlay removed */
    
    /* Video effects removed - clean video display */
    
    /* Slide transition animations */
    @keyframes slideOutLeft {
      0% {
        transform: translateX(0);
        opacity: 1;
      }
      100% {
        transform: translateX(-100%);
        opacity: 0;
      }
    }
    
    @keyframes slideInRight {
      0% {
        transform: translateX(100%);
        opacity: 0;
      }
      100% {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    @keyframes slideOutRight {
      0% {
        transform: translateX(0);
        opacity: 1;
      }
      100% {
        transform: translateX(100%);
        opacity: 0;
      }
    }
    
    @keyframes slideInLeft {
      0% {
        transform: translateX(-100%);
        opacity: 0;
      }
      100% {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    #page.slide-out-left {
      animation: slideOutLeft 0.25s cubic-bezier(0.4, 0.0, 1, 1) forwards;
    }
    
    #page.slide-in-right {
      animation: slideInRight 0.25s cubic-bezier(0.0, 0.0, 0.2, 1) forwards;
    }
    
    #page.slide-out-right {
      animation: slideOutRight 0.25s cubic-bezier(0.4, 0.0, 1, 1) forwards;
    }
    
    #page.slide-in-left {
      animation: slideInLeft 0.25s cubic-bezier(0.0, 0.0, 0.2, 1) forwards;
    }
    
    
    /* Video overlay (disabled for small centered video) */
    .bg-overlay {
      display: none;
    }
    
    #bg-overlay {
      display: none;
    }
    /* Your actual content goes above (z-index > 0) */
    .content {
      position: relative;
      z-index: 1;
      color: #e8e8e8;
      font: 16px/1.5 system-ui, sans-serif;
      padding: 6vmin;
    }
    html,body { height:100%; margin:0; background:#000; }

    /* Font Definition - Crisp Only */
    @font-face {
      font-family: 'Crisp';
      src: url('fonts/fonts/Crisp.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
      font-display: swap;
    }
    
    :root { 
      --fg:#00DD00; 
      --bg:#000; 
      --accent:#00DD00; 
      --soft:#66FF66;
      --font-family: 'Crisp', 'Courier New', monospace;
    }
    html, body { height:100%; }
    
    /* FORCE NO SCROLLING */
    html {
      overflow: hidden;
      height: 100%;
      width: 100%;
    }
    
    body {
      overflow: hidden;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background:var(--bg); 
      color:var(--fg); 
      font-family:var(--font-family);
      padding: 0;
      perspective: 1000px; 
      margin: 0;
      line-height:1.6; 
      -webkit-user-select: none;
      user-select: none;
      font-size: 1rem;
      box-sizing: border-box;
    }
    
    /* Scanline overlay */
    #scanline-overlay {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      right: 0 !important;
      bottom: 0 !important;
      width: 100% !important;
      height: 100% !important;
      background-image: repeating-linear-gradient(
        to bottom,
        rgba(0, 0, 0, 0.2) 0px,
        rgba(0, 0, 0, 0.2) 3px,
        transparent 3px,
        transparent 6px
      ) !important;
      pointer-events: none !important;
      z-index: 2147483647 !important;
      display: block !important;
      visibility: visible !important;
    }
    
    /* Hide scanlines on video slide */
    body.video-slide-active #scanline-overlay {
      display: none !important;
    }
    
    
    
    @media (max-width: 768px) {
      body {
        padding: 0 !important;
        margin: 0 !important;
        font-size: 0.85rem;
        padding-left: 0 !important;
        max-width: 100% !important;
        width: 100% !important;
        left: 0 !important;
        right: 0 !important;
        overflow: hidden !important;
        -webkit-text-size-adjust: 100%; /* Prevent iOS text scaling */
        text-size-adjust: 100%; /* Standard property for Chrome/Edge */
        -webkit-tap-highlight-color: transparent; /* Remove tap highlights */
      }
      #page {
        padding: 1vh 3vw; /* Slightly more padding for better readability */
        height: 75vh; /* Better height for mobile */
        min-height: 30em;
        width: 100% !important;
        max-width: 100% !important;
        margin: 0 !important;
        left: 0 !important;
        right: 0 !important;
        position: relative !important; /* Override desktop positioning */
        box-sizing: border-box !important;
        overflow-x: hidden !important;
      }
      #text-wrap {
        width: 100% !important; /* Force full width on mobile */
        max-width: 100% !important;
        margin-top: 0; /* Remove negative margin that was causing issues */
        height: calc(100% - 2rem); /* Better height calculation */
        padding: 1.5rem 2vw !important; /* Better padding for mobile */
        box-sizing: border-box !important;
        overflow-x: hidden !important;
        position: relative !important; /* Override desktop fixed positioning */
        top: auto !important; /* Override desktop centering */
        left: auto !important; /* Override desktop centering */
        transform: none !important; /* Override desktop centering */
        z-index: 9999999 !important;
      }
      
      #unscramble {
        font-size: 1.0rem; /* Larger text on mobile */
        line-height: 1.4; /* Better line spacing */
        width: 100% !important; /* Force full width */
        max-width: 100% !important;
        padding: 0 !important;
        margin: 0 !important;
        box-sizing: border-box !important;
        word-wrap: break-word !important;
        overflow-wrap: break-word !important;
        white-space: pre-wrap !important;
        overflow-x: hidden !important;
        word-break: break-word !important; /* Force word breaking on mobile */
        -ms-hyphens: auto; /* IE hyphenation */
        -webkit-hyphens: auto; /* Safari hyphenation */
        hyphens: auto !important; /* Enable hyphenation on mobile */
      }
      #nav {
        font-size: 1rem; /* Larger for better touch targets */
        margin: 0.5vh 0;
        padding: 0.5rem 0; /* Better touch area */
      }
      #nav span {
        padding: 0.5rem 1rem; /* Larger touch targets */
        min-height: 44px; /* iOS recommended touch target size */
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }
      #nav-msg {
        font-size: 0.7rem; /* Slightly larger */
        line-height: 1.2;
        padding: 0.5rem;
      }
      /* Slide counter mobile styles handled in main styles */
      #prompt {
        font-size: 0.75rem; /* Slightly larger */
        line-height: 1.3;
      }
      
      /* Mobile video sizing removed - handled in main mobile styles */
      
      /* Force full width on mobile regardless of image mode */
      #text-wrap.side-mode,
      #text-wrap.small-side-mode {
        width: 100% !important;
        max-width: 100% !important;
        position: relative !important;
        z-index: 2 !important;
        padding: 1rem 0.5vw !important; /* Minimal padding for wider text */
        box-sizing: border-box !important;
        overflow-x: hidden !important;
      }
      
      #text-wrap.side-mode #unscramble,
      #text-wrap.small-side-mode #unscramble {
        width: 100% !important;
        max-width: 100% !important;
        padding: 0 !important;
        margin: 0 !important;
        box-sizing: border-box !important;
        word-wrap: break-word !important;
        overflow-wrap: break-word !important;
        white-space: pre-wrap !important;
        overflow-x: hidden !important;
        word-break: break-word !important; /* Force word breaking on mobile */
        hyphens: auto !important; /* Enable hyphenation on mobile */
      }
      
      /* Additional mobile constraints to prevent overflow */
      *:not(.bg-video):not(#bg-video3):not(.video-container):not(#video-container) {
        max-width: 100% !important;
        box-sizing: border-box !important;
      }
      
      /* Allow video and container to scale beyond viewport */
      .bg-video, #bg-video3, .video-container, #video-container {
        max-width: none !important;
      }
      
      /* Ensure no element can cause horizontal overflow */
      html {
        overflow: hidden !important;
      }
      
      #page, #text-wrap, #unscramble {
        overflow-x: hidden !important;
        max-width: 100vw !important;
      }
      
      /* First slide mobile - bigger text */
      #page[data-page="1"] #unscramble {
        font-size: 1.1em !important;
        line-height: 1.3 !important;
      }
      
      /* Slides 4, 5, 6, 7 mobile - slightly bigger text */
      #page[data-page="4"] #unscramble,
      #page[data-page="5"] #unscramble,
      #page[data-page="6"] #unscramble,
      #page[data-page="7"] #unscramble {
        font-size: 1.0em !important;
        line-height: 1.3 !important;
        overflow: hidden !important;
        height: 100% !important;
      }
      
      /* Slides 4, 5, 6, 7 mobile - reduce top padding and prevent scrolling */
      #page[data-page="4"] #text-wrap,
      #page[data-page="5"] #text-wrap,
      #page[data-page="6"] #text-wrap,
      #page[data-page="7"] #text-wrap {
        padding-top: 0.5vw !important;
        padding-bottom: 10vh !important;
        overflow: hidden !important;
        height: 100vh !important;
      }
      
      /* Slides 4, 5, 6, 7 mobile - ensure page container has no scroll */
      #page[data-page="4"],
      #page[data-page="5"],
      #page[data-page="6"],
      #page[data-page="7"] {
        overflow: hidden !important;
      }
      
      
      /* Better mobile navigation */
      #nav {
        position: fixed;
        bottom: 15vh;
        left: 50%;
        transform: translateX(-50%);
        width: auto;
        z-index: 99997;
        padding: 1rem 1.5rem;
        min-height: 60px;
      }
      
      /* Mobile slide counter positioning */
      #slide-counter {
        position: fixed;
        bottom: 7rem;
        left: 50%;
        transform: translateX(-50%);
        font-size: 0.9rem;
        padding: 0.5rem 1rem;
        z-index: 100000;
      }
      
      /* Mobile nav message improvements */
      #nav-msg {
        padding: 0.75rem;
        margin: 0 1rem;
        text-align: center;
      }
    }
    
    @media screen and (min-resolution: 1dppx) {
            body {
        font-size: 1.0rem;
      }
    }
    #page {
      position: relative;
      width: 70vh; /* Smaller video box */
      height: 60vh; /* Smaller video box */
      min-height: 20em; 
      margin: 0 auto; /* Center horizontally */
      padding: 2rem;
      border-radius: 10px;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      overflow: visible;
      box-sizing: border-box;
    }
    
 /* Simple image display */
     #page img {
       display: none;
       filter: grayscale(1) brightness(0.8) contrast(1.2) sepia(1) hue-rotate(60deg) saturate(4);
       /* Grayscale + green tint: black stays black, white becomes green */
       /* Ensure all image formats including GIFs display properly */
       image-rendering: auto;
     }
     
   /* Special rule: dim only photo7 - REMOVED (was too dark) */
      
      /* Special rule: dim only photo23 */
      #page img[id="img-23"] {
filter: grayscale(1) brightness(0.5) contrast(1.2) sepia(1) hue-rotate(60deg) saturate(4);
      }
      
      /* Special rule: make page 10 images darker */
      #page img[id^="img-10"] {
filter: grayscale(1) brightness(0.5) contrast(1.2) sepia(1) hue-rotate(60deg) saturate(4);
      }
    
    #page img.show-bg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: -1;
      display: block;
    }
    
 #page img.show-below {
       display: block;
       margin-top: 1rem;
       max-height: 40%;
       max-width: 100%;
       object-fit: contain;
       position: relative;
       top: -12rem;
       z-index: -1;
     }
    
     #page img.show-side {
display: block;
position: absolute;
right: 0;
top: 0;
width: 50%;
height: 100%;
object-fit: cover;
z-index: 1;
      }
      
     #page img.show-small-side {
 display: block;
 position: absolute;
 right: 0;
 top: 0;
 width: 25%;
 height: 60%;
 object-fit: cover;
 z-index: 1;
       }
    
    /* Text container width is now controlled by JavaScript */
    
    /* Hide the default cursor */
    body {
      cursor: none;
    }
    
    /* Custom cursor element */
    #custom-cursor {
      position: fixed;
      width: 10px;
      height: 10px;
      background: var(--accent);
      border-radius: 50%;
      pointer-events: none;
      z-index: 10000;
      mix-blend-mode: difference;
      display: none;
    }
    
    /* Hide cursor on mobile */
    @media (max-width: 768px) {
      #custom-cursor {
        display: none !important;
      }
    }

    /* Year styling - match regular text */
    .year-text {
      /* Years inherit parent styling - no special formatting */
    }
    
    /* Ensure text content appears above video and photos */
    @media (min-width: 769px) {
      #text-wrap, #unscramble, #page {
        position: relative;
        z-index: 9999999 !important;
      }
    }
    
    /* First slide text - bigger */
    #page[data-page="1"] #unscramble {
      font-size: 1.2em !important;
      line-height: 1.4 !important;
    }
    
    /* Slide 2 text 10% bigger */
    #page[data-page="2"] #unscramble {
      font-size: 1.1em !important;
    }
    
    /* Slide 3 text slightly smaller and centered */
    #page[data-page="3"] #unscramble {
      font-size: 0.95em !important;
      text-align: center !important;
    }
    
    /* Slides 4, 5, 6, 7 - slightly bigger text */
    #page[data-page="4"] #unscramble,
    #page[data-page="5"] #unscramble,
    #page[data-page="6"] #unscramble,
    #page[data-page="7"] #unscramble {
      font-size: 1.05em !important;
      overflow: hidden !important;
      height: 100% !important;
    }
    
    /* Slides 4, 5, 6, 7 - fix text positioning for image slides */
    #page[data-page="4"] #text-wrap,
    #page[data-page="5"] #text-wrap,
    #page[data-page="6"] #text-wrap,
    #page[data-page="7"] #text-wrap {
      padding-top: 0.5rem !important; /* Less padding to move text down */
      padding-bottom: 4rem !important;
      overflow: hidden !important;
      height: 100vh !important;
    }
    
    /* All pages - ensure no scroll */
    #page {
      overflow: hidden !important;
      position: relative;
    }
    
    /* Slides 4, 5, 6, 7 - ensure page container has no scroll */
    #page[data-page="4"],
    #page[data-page="5"],
    #page[data-page="6"],
    #page[data-page="7"] {
      overflow: hidden !important;
    }
    
    
    
    /* Video loading status */
    #video-loading {
      position: fixed;
      top: calc(100vh - 8rem);
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10001;
      text-align: center;
      pointer-events: none;
    }
    
    .loading-text {
      font-family: var(--font-family);
      font-size: 1.2rem;
      color: var(--soft);
      text-shadow: 0 0 2px var(--soft), 0 0 12px var(--soft);
      margin-bottom: 1.5rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
    }
    
    .loading-bar {
      width: 300px;
      height: 4px;
      background: rgba(102, 255, 102, 0.2);
      border: 1px solid var(--soft);
      border-radius: 2px;
      overflow: hidden;
      position: relative;
    }
    
    .loading-progress {
      height: 100%;
      background: var(--soft);
      box-shadow: 0 0 4px var(--soft);
      width: 0%;
      transition: width 0.3s ease;
      animation: loadingPulse 1.5s ease-in-out infinite;
    }
    
    @keyframes loadingPulse {
      0%, 100% { 
        opacity: 0.6;
        box-shadow: 0 0 4px var(--soft);
      }
      50% { 
        opacity: 1;
        box-shadow: 0 0 8px var(--soft), 0 0 16px var(--soft);
      }
    }
    
    /* Desktop-specific styling to match old version exactly */
    @media (min-width: 769px) {
      body {
        padding: 5vw;
        padding-left: 20vw;
        max-width: 80vw;
        margin: 2vh auto;
        min-height: 100vh;
      }
      
      #page {
        position: relative;
        height: 60vh;
        min-height: 20em;
        padding: 2rem;
        border-radius: 10px;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        overflow: visible;
      }
      
      #text-wrap {
        min-width: 0;
        margin-top: -1.4rem;
        width: 100%;
        height: calc(100% - 2rem);
        box-sizing: border-box;
        overflow: hidden;
        position: relative;
        top: auto;
        left: auto;
        transform: none;
        padding: 0;
        z-index: auto;
      }
      
      #unscramble {
        white-space: pre-wrap;
        font-size: 1.8rem;
        line-height: 1.5;
        word-wrap: break-word;
        overflow-wrap: break-word;
        height: 100%;
        overflow: hidden;
        width: 100%;
        box-sizing: border-box;
        max-width: 100%;
        text-indent: 0;
        word-break: normal;
        hyphens: none;
      }
      
      #nav {
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 0;
        font-size: 1.8rem;
        min-height: 5vh;
        position: fixed;
        bottom: 15vh;
        left: calc(20vw + 40vw / 2);
        transform: translateX(-50%);
        width: auto;
        z-index: 2147483648;
        padding: 0.75rem 1rem;
        gap: 4vw;
        text-align: center;
      }
      
      #nav-msg {
        flex-grow: 1;
        text-align: center;
        font-size: 0.9rem;
        min-height: 1.5rem;
        visibility: hidden;
      }
      
      /* Desktop image display classes - matching old version */
      #page img {
        display: none;
        filter: brightness(0.7) sepia(1) hue-rotate(60deg) saturate(1.5);
        image-rendering: auto;
      }
      
      #page img.show-bg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: -1;
        display: block;
      }
      
      #page img.show-below {
        display: block;
        margin-top: 1rem;
        max-height: 40%;
        max-width: 100%;
        object-fit: contain;
        position: relative;
        top: -12rem;
        z-index: -1;
      }
      
      #page img.show-side {
        display: block;
        position: absolute;
        right: 0;
        top: 0;
        width: 50%;
        height: 100%;
        object-fit: cover;
        z-index: 1;
      }
      
      #page img.show-small-side {
        display: block;
        position: absolute;
        right: 0;
        top: 0;
        width: 25%;
        height: 60%;
        object-fit: cover;
        z-index: 1;
      }
      
      /* Side mode: text on left, image on right */
      #text-wrap.side-mode {
        width: 50% !important;
        max-width: 50% !important;
        position: relative !important;
        z-index: 2 !important;
      }
      
      /* Small side mode: text on left, smaller image on right */
      #text-wrap.small-side-mode {
        width: 75% !important;
        max-width: 75% !important;
        position: relative !important;
        z-index: 2 !important;
      }
      
      #text-wrap.side-mode #unscramble {
        width: 100% !important;
        max-width: 100% !important;
        overflow: hidden !important;
        white-space: pre-wrap !important;
        word-wrap: normal !important;
        overflow-wrap: normal !important;
        hyphens: none !important;
        text-indent: 0 !important;
      }
      
      #text-wrap.small-side-mode #unscramble {
        width: 100% !important;
        max-width: 100% !important;
        overflow: hidden !important;
        white-space: pre-wrap !important;
        word-wrap: normal !important;
        overflow-wrap: normal !important;
        hyphens: none !important;
        text-indent: 0 !important;
        font-size: 1.0rem !important;
        line-height: 1.3 !important;
      }
    }
    
    /* Mobile loading status */
    @media (max-width: 768px) {
      .loading-text {
        font-size: 1rem;
      }
      .loading-bar {
        width: 250px;
        height: 3px;
      }
    }
    
 #text-wrap { 
       position: fixed;
       top: 40%; /* Higher up */
       left: 42%; /* Further left - moved from 50% to 42% */
       transform: translate(-50%, -50%);
       width: 70vh; /* Match smaller page width */
       height: 60vh; /* Match smaller page height */
       box-sizing: border-box;
       overflow: hidden !important;
       padding: 2rem 2rem 2rem 1rem; /* Less left padding to show more text */
       z-index: 2;
       -webkit-backface-visibility: hidden;
       backface-visibility: hidden;
       transform: translate(-50%, -50%) translateZ(0);
       -webkit-transform: translate(-50%, -50%) translateZ(0);
     }
     
    /* Mobile-specific text-wrap overrides */
    @media (max-width: 768px) {
      #text-wrap {
        margin-top: 0; /* Remove negative margin on mobile */
        height: calc(100% - 2rem); /* Better height calculation for mobile */
        padding: 1.5rem 0.5vw !important; /* Minimal side padding for wider text */
        height: 70vh; /* Increased height for mobile */
        min-height: 25em;
        width: 100% !important;
        max-width: 100% !important;
        margin: 0 !important;
        left: 0 !important;
        right: 0 !important;
        box-sizing: border-box !important;
        overflow: hidden !important;
      }
    }
                    #unscramble { 
      white-space: pre-wrap; 
      font-size: 1.15rem;
      line-height: 1.5;
      word-wrap: break-word;
      overflow-wrap: break-word;
      height: 100%;
      overflow: hidden !important;
      overflow-x: hidden !important;
      overflow-y: hidden !important;
      width: 100%;
      box-sizing: border-box;
      max-width: 100%;
      /* Preserve original formatting - no text wrapping modifications */
      text-indent: 0;
      word-break: normal;
      hyphens: none;
    }
    
     
     /* Handle indented line wrapping - preserve indentation for continuation lines */
     #unscramble .indented-line {
       display: block;
       text-indent: 2em; /* Standard indentation */
     }
     
     #unscramble .continuation {
       display: block;
       text-indent: 2em; /* Same indentation as parent */
     }
    #prompt { 
      margin-top:1rem; 
      visibility:hidden; 
      white-space:pre-wrap; 
      line-height:1.3; 
      font-size: 0.9rem;
    }

    #nav { 
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0; 
      font-size: 0.9rem;
      min-height: 7vh;
      position: fixed;
      bottom: 15vh;
      left: 50%;
      transform: translateX(-50%);
      width: auto;
      z-index: 2147483648;
      padding: 0.75rem 0;
      gap: 1.5rem;
    }
    
    /* Desktop - reduced padding for closer arrows - removed redundant rule */
    @media (min-width: 769px) {
      #nav {
        /* Padding removed to fix centering */
      }
    }
    #nav span { cursor:pointer; -webkit-user-select: none; user-select: none; padding:0 0.5em; }
          #nav-msg { 
      flex-grow:0; 
      text-align: center; 
      font-size:0.7rem;
      min-height: 2.5rem;
      visibility: hidden;
      max-width: 140px;
      line-height: 1.3;
      white-space: normal;
      display: inline-block;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    #slide-counter {
      position: fixed;
      bottom: 15vh;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.65rem;
      opacity: 1;
      color: var(--accent);
      text-shadow: 0 0 2px var(--accent), 0 0 5px var(--accent);
      font-family: var(--font-family);
      pointer-events: none;
      z-index: 2147483649;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      text-align: center;
      margin: 0;
      padding: 0;
      white-space: nowrap;
      visibility: visible;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 7vh;
    }
    
    /* Push slide counter down on pages 1 and 2 */
    #page[data-page="1"] ~ #slide-counter,
    #page[data-page="2"] ~ #slide-counter {
      bottom: 12vh;
    }
    
   /* Side mode: text on left, image on right */
      #text-wrap.side-mode {
width: 50% !important;
max-width: 50% !important;
position: relative !important;
z-index: 2 !important;
      }
      
     /* Small side mode: text on left, smaller image on right */
       #text-wrap.small-side-mode {
 width: 75% !important;
 max-width: 75% !important;
 position: relative !important;
 z-index: 2 !important;
       }
    
  #text-wrap.side-mode #unscramble {
      width: 100% !important;
      max-width: 100% !important;
      overflow: hidden !important;
      white-space: pre-wrap !important;
      word-wrap: normal !important;
      overflow-wrap: normal !important;
      hyphens: none !important;
      text-indent: 0 !important;
      padding-left: 0.5rem !important;
      padding-right: 0.5rem !important;
    }
    
    #text-wrap.small-side-mode #unscramble {
      width: 100% !important;
      max-width: 100% !important;
      overflow: hidden !important;
      white-space: pre-wrap !important;
      word-wrap: normal !important;
      overflow-wrap: normal !important;
      hyphens: none !important;
      text-indent: 0 !important;
      font-size: 1.0rem !important;
      line-height: 1.3 !important;
      padding-left: 0.5rem !important;
      padding-right: 0.5rem !important;
    }
    
    
    /* Collateral Murder animation removed - no more scrolling */
    
    /* Ensure all unscramble elements have consistent padding */
    #unscramble {
      padding-left: 0.5rem !important;
      padding-right: 0.5rem !important;
      padding-top: 0 !important; /* No top padding - container handles it */
    }
    
    /* Add top padding for slides 2 and 3 */
    #page[data-page="2"] #unscramble,
    #page[data-page="3"] #unscramble {
      padding-top: 1rem !important;
    }
    
    /* Slides 4, 5, 6, 7 - NO extra top padding on unscramble (container handles it) */
    #page[data-page="4"] #unscramble,
    #page[data-page="5"] #unscramble,
    #page[data-page="6"] #unscramble,
    #page[data-page="7"] #unscramble {
      padding-top: 0 !important;
    }
    
    /* Scanline movement animation */
    @keyframes scanlineMove {
      0% {
        transform: translateY(-100vh);
      }
      100% {
        transform: translateY(100vh);
      }
    }
    
    /* Mobile styles for last slide image */
    @media (max-width: 768px) {
      #last-slide-image-container {
        max-width: 85vw !important;
        max-height: 75vh !important;
        width: 85vw !important;
        height: 75vh !important;
        min-width: 80vw !important;
        min-height: 70vh !important;
        transform: translate(-50%, -60%) !important;
      }
      #last-slide-image {
        width: 100% !important;
        height: 100% !important;
        object-fit: contain !important;
      }
    }
    
    /* Common utility classes for better CSS organization */
    .full-screen-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      z-index: 1000;
      pointer-events: none;
    }
    
    .centered-content {
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding-top: 2rem;
    }
    
    .accent-text {
      color: var(--accent);
      font-family: var(--font-family);
      text-shadow: 0 0 10px var(--accent);
    }
    
    /* Persistent text that stays on screen */
    #persistent-text {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      z-index: 1000;
      pointer-events: none;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding-top: 2rem;
    }
    
    #persistent-text .text-content {
      color: var(--accent);
      font-family: var(--font-family);
      text-shadow: 0 0 10px var(--accent);
      font-size: 2rem;
      text-align: center;
      font-weight: bold;
    }
    
     

  </style>
</head>
<body>

  <!-- video2 removed - defunct -->

  <!-- Video for slide 3: FADELONG_mobile.mp4 - EXACT V3 PATTERN -->
  <video
    id="bg-video-fadelong"
    class="bg-video"
    autoplay
    muted
    playsinline
    loop
    preload="metadata"
    aria-hidden="true"
    tabindex="-1"
    disablepictureinpicture
    controlslist="nodownload noplaybackrate noptimizequality nodatachannel"
    volume="0"
    defaultMuted
    style="display: none;"
  >
    <source src="VIDEOS/FADELONG_mobile.mp4" type="video/mp4" />
  </video>
  
  <div class="video-container" id="video-container">
  <!-- Video for slide 7: TRAILER.mp4 -->
  <video
    id="bg-video3"
    class="bg-video bg-video3"
    playsinline
    preload="metadata"
    aria-hidden="true"
    tabindex="-1"
    disablepictureinpicture
    controlslist="nodownload noplaybackrate noptimizequality nodatachannel"
    volume="1"
    style="display: none;"
  >
  </video>
  </div>
  
  
  <!-- Audio for FADELONG video (slide 3) - EXACT V3 PATTERN -->
  <audio
    id="fadelong-audio"
    preload="metadata"
    style="display: none;"
  >
    <source src="VIDEOS/FADELONG_audio.m4a" type="audio/mp4" />
  </audio>
  
  <!-- Text overlay on top of video -->
  <div id="video-text-overlay" style="display: none;">
    A FILM BY EUGENE JARECKI
  </div>
  
  <!-- Scanline patch over video text -->
  <div id="video-text-scanlines"></div>
  
  <!-- Scanline patch over navbar -->
  <div id="nav-scanlines"></div>
  
  <!-- Text unscramble audio -->
  <audio id="text-audio" preload="auto">
    <source src="TEXTAUDIO.mp4" type="audio/mp4">
  </audio>
  
  <!-- Unscramble typing audio -->
  <audio id="unscramble-audio" preload="auto">
    <source src="VIDEOS/speduptyping.wav" type="audio/wav">
  </audio>
  
  <!-- Scanline overlay on top of everything -->
  <div id="scanline-overlay"></div>
  
  
  <!-- OBIWAN_REAL audio removed - defunct -->

  <div class="bg-overlay" id="bg-overlay"></div>

  <div id="page">
    <div id="text-wrap">
      <div id="unscramble"></div>
      <div id="prompt"></div>
    </div>
    
    <!-- Images will be added here dynamically -->
  </div>

  <div id="nav">
    <span id="nav-prev">&lt;</span>
    <span id="nav-msg"></span>
    <span id="nav-next">&gt;</span>
  </div>

  <div id="slide-counter">SLIDE 1 / 1</div>

  
  <!-- Custom cursor -->
  <div id="custom-cursor"></div>

  <script>
    /* ================== CONTENT ================== */
    const fullTextRaw = `
RECIPIENT: DORSEY.6BDM180925

EYES ONLY / NO FWD / 
NO DSTRO

SOURCE: CSF
FILE ID: 369-108-11







THE SIX BILLION DOLLAR
MAN


PRESS [F] FOR FULL SCREEN





 
 
 
 
              
 
      
 
         
 
 
 
     


6BDM: JULIAN ASSANGE AND THE PRICE OF TRUTH




2006: JULIAN ASSANGE BUILDS WIKILEAKS TO ENABLE WHISTLEBLOWERS TO INFORM THE PUBLIC.

2010: WIKILEAKS RELEASES LARGEST TROVE OF U.S. MILITARY SECRETS IN HISTORY, EXPOSING U.S. WAR CRIMES.

2012-2019: U.S. AUTHORITIES CHARGE ASSANGE WITH ESPIONAGE. HE TAKES ASYLUM IN ECUADORIAN EMBASSY, LONDON.




2019: ASSANGE IS IMPRISONED IN THE UK FOR FIVE YEARS. AWAITS EXTRADITION TO THE U.S TO FACE A FURTHER 175.

2024: U.S. SUDDENLY DROPS 17 OF ITS 18 COUNTS AGAINST ASSANGE, DISMISSES CASE. ASSANGE PLEADS GUILTY ONLY TO JOURNALISM AND RETURNS TO AUSTRALIA A FREE MAN.





IN 2025, THE SIX BILLION DOLLAR MAN WON THE CANNES FILM FESTIVAL AND THE FIRST-EVER GOLDEN GLOBE FOR DOCUMENTARY. BUT NO LEGACY MEDIA WILL TOUCH IT.
 
SO, LIKE WIKILEAKS, WE ARE TAKING THE FILM DIRECT TO THE PUBLIC. 

FOR THIS, WE NEED YOUR HELP. 







`;

    /* ================== AUDIO SYSTEM ================== */
    let audioContext = null;
    let audioEnabled = true; // Enable audio by default
    let debugMode = true;
    let currentAudio = null; // Track currently playing audio
    let audioVolume = 0.67; // Default volume level
    let typingAudio = null; // Track typing audio for video end subtitle
    
    // Function to stop any currently playing audio
    function stopCurrentAudio() {
      if (currentAudio) {
        console.log('🛑 Stopping current audio...');
        currentAudio.pause();
        currentAudio.currentTime = 0;
        currentAudio.src = ''; // Clear the source
        currentAudio.load(); // Reset the audio element
        currentAudio = null;
      }
      
      
      // Also stop any other audio elements that might be playing
      const allAudioElements = document.querySelectorAll('audio');
      allAudioElements.forEach(audio => {
        if (!audio.paused) {
          audio.pause();
          audio.currentTime = 0;
        }
      });
    }
    
    
    
    
    


    // Test audio function removed - defunct

    // Video preloading system
    const videoPreloadState = {
      'bg-video3': false
    };

    function preloadVideo(videoId) {
      const video = document.getElementById(videoId);
      if (!video || videoPreloadState[videoId]) return;
      
      console.log(`🎬 Preloading ${videoId}...`);
      video.preload = 'metadata';
      video.load();
      
      video.addEventListener('canplay', () => {
        console.log(`✅ ${videoId} preloaded successfully`);
        videoPreloadState[videoId] = true;
        video.removeEventListener('canplay', arguments.callee);
      }, { once: true });
    }



    // Video2 functions removed - defunct

    // Unlock audio context on user interaction
    function unlockAudioContext() {
      if (!audioContextUnlocked) {
        console.log('🔓 Unlocking audio context...');
        
        // Enable audio if not already enabled
        if (!audioEnabled) {
          audioEnabled = true;
          console.log('🔊 Audio enabled on first interaction');
        }
        
        // Initialize audio context first
        initAudioContext();
        
        // OBIWAN audio removed - use Web Audio API only
            if (audioContext && audioContext.state === 'suspended') {
              audioContext.resume().then(() => {
                audioContextUnlocked = true;
                console.log('✅ Audio context unlocked via resume');
              }).catch(resumeErr => {
                console.log('❌ Audio context resume failed:', resumeErr.message);
              });
        }
      }
    }


    // FADELONG video functions - EXACT COPY FROM V3, only changed IDs and source
    function showFadelongVideo() {
      console.log('🎬 Showing FADELONG_mobile video with audio...');
      const video = document.getElementById('bg-video-fadelong');
      const audio = document.getElementById('fadelong-audio');
      
      console.log('🔍 Video element found:', !!video);
      console.log('🔍 Audio element found:', !!audio);
      
      if (video) {
        console.log('🎬 Video element properties:', {
          id: video.id,
          src: video.src || video.querySelector('source')?.src,
          display: window.getComputedStyle(video).display,
          zIndex: window.getComputedStyle(video).zIndex,
          position: window.getComputedStyle(video).position,
          width: window.getComputedStyle(video).width,
          height: window.getComputedStyle(video).height,
          opacity: window.getComputedStyle(video).opacity
        });
        
        // Show video immediately
        video.style.setProperty('display', 'block', 'important');
        video.muted = true;   // Keep video muted
        video.loop = true;    // Video loops visually
        video.currentTime = 0;
        
        console.log('🎬 After setting display block:', {
          inlineDisplay: video.style.display,
          computedDisplay: window.getComputedStyle(video).display,
          offsetWidth: video.offsetWidth,
          offsetHeight: video.offsetHeight
        });
        
        // Set up video event listeners
        const onCanPlay = () => {
          console.log('✅ FADELONG video ready to play');
          console.log('🎬 Video dimensions:', video.videoWidth, 'x', video.videoHeight);
          console.log('🎬 Video playing:', !video.paused);
          console.log('🎬 Video visible:', video.offsetWidth > 0 && video.offsetHeight > 0);
          video.removeEventListener('canplay', onCanPlay);
          video.removeEventListener('error', onError);
        };
        
        const onError = (e) => {
          console.log('❌ FADELONG video failed to load:', e);
          console.log('❌ Error code:', video.error ? video.error.code : 'unknown');
          console.log('❌ Error message:', video.error ? video.error.message : 'unknown');
          video.removeEventListener('canplay', onCanPlay);
          video.removeEventListener('error', onError);
        };
        
        const onPlay = () => {
          console.log('▶️ FADELONG video play event fired');
          console.log('🎬 Video visible check:', {
            computedDisplay: window.getComputedStyle(video).display,
            offsetWidth: video.offsetWidth,
            offsetHeight: video.offsetHeight,
            paused: video.paused,
            readyState: video.readyState
          });
        };
        
        video.addEventListener('canplay', onCanPlay);
        video.addEventListener('error', onError);
        video.addEventListener('play', onPlay);
        
        console.log('▶️ Attempting to play FADELONG video...');
        video.play().then(() => {
          console.log('✅ FADELONG video play() promise resolved');
        }).catch(err => {
          console.log('❌ FADELONG video play failed:', err.message);
        });
      } else {
        console.error('❌ FADELONG video element not found!');
      }
      
      if (audio) {
        audio.volume = 0.7;   // Set audio volume
        audio.muted = false;  // Ensure not muted
        audio.currentTime = 0;
        
        // Try to play with better error handling
        console.log('🔊 Attempting to play FADELONG audio...');
        audio.play().then(() => {
          console.log('✅ FADELONG audio playing successfully');
        }).catch(err => {
          console.log('❌ FADELONG audio play failed:', err.message);
          console.log('🔧 This might require user interaction first');
        });
      }
    }

    function hideFadelongVideo() {
      console.log('🛑 Hiding FADELONG video and stopping audio...');
      const video = document.getElementById('bg-video-fadelong');
      const audio = document.getElementById('fadelong-audio');
      
      if (video) {
        video.pause();
        video.style.setProperty('display', 'none', 'important');
      }
      
      if (audio) {
        audio.pause();
        audio.currentTime = 0; // Reset to beginning
      }
    }

    // Video3 functions - for trailer only (slide 7)
    function showVideo3Background() {
      console.log('🎬 Showing trailer video...');
      const video = document.getElementById('bg-video3');
      const videoContainer = document.getElementById('video-container');
      
      if (video) {
        // Show video container first
        if (videoContainer) {
          videoContainer.style.display = 'flex';
          videoContainer.style.pointerEvents = 'auto';
        }
        
        // Show video immediately
        video.style.setProperty('display', 'block', 'important');
        video.currentTime = 0;
        
        // Set up video event listeners
        const onCanPlay = () => {
          console.log('✅ Video3 ready to play');
          video.removeEventListener('canplay', onCanPlay);
          video.removeEventListener('error', onError);
        };
        
        const onError = (e) => {
          console.log('❌ Video3 failed to load:', e);
          video.removeEventListener('canplay', onCanPlay);
          video.removeEventListener('error', onError);
        };
        
        video.addEventListener('canplay', onCanPlay);
        video.addEventListener('error', onError);
        
        // Autoplay trailer
        video.play().catch(err => {
          console.log('Video3 play failed:', err.message);
        });
      }
    }
    
    // Function to start typing subtitle when video ends
    function startVideoEndSubtitle() {
      // Create or get the subtitle element
      let subtitleEl = document.getElementById('video-end-subtitle');
      if (!subtitleEl) {
        subtitleEl = document.createElement('div');
        subtitleEl.id = 'video-end-subtitle';
        const isMobile = window.innerWidth <= 768;
        subtitleEl.style.cssText = `
          position: fixed;
          top: calc(45% + 30vh);
          left: calc(42% - 35vh);
          color: var(--accent);
          font-family: var(--font-family);
          font-size: ${isMobile ? '1.2rem' : '1.5rem'};
          text-align: left;
          z-index: 2147483648;
          pointer-events: none;
          white-space: pre-wrap;
          text-shadow: 0 0 2px var(--accent), 0 0 5px var(--accent);
        `;
        document.body.appendChild(subtitleEl);
      }
      
      // Type the message character by character
      const message = '6BDM:\nJULIAN ASSANGE AND THE PRICE OF TRUTH';
      
      // Stop any existing typing audio
      if (typingAudio) {
        typingAudio.pause();
        typingAudio = null;
      }
      
      // Create a new audio instance for typing sound
      typingAudio = new Audio('VIDEOS/speduptyping.wav');
      typingAudio.volume = 0.3; // Match unscramble audio volume
      typingAudio.loop = true; // Loop during typing
      typingAudio.muted = false; // Ensure not muted
      
      // Play typing audio
      console.log('🔊 Playing speduptyping.wav for 6BDM message... Volume:', typingAudio.volume, 'Muted:', typingAudio.muted);
      typingAudio.play().then(() => {
        console.log('✅ speduptyping.wav playing successfully - Volume:', typingAudio.volume, 'Paused:', typingAudio.paused);
      }).catch(err => {
        console.error('❌ speduptyping.wav play failed:', err.message);
      });
      
      let charIndex = 0;
      const typingInterval = setInterval(() => {
        if (charIndex < message.length) {
          const currentText = message.substring(0, charIndex + 1);
          // Format with smaller second line
          const lines = currentText.split('\n');
          if (lines.length > 1) {
            subtitleEl.innerHTML = lines[0] + '<br><span style="font-size: 0.75em;">' + lines[1] + '</span>';
      } else {
            subtitleEl.textContent = currentText;
          }
          charIndex++;
        } else {
          clearInterval(typingInterval);
          // Stop typing audio when typing is complete
          typingAudio.pause();
          typingAudio.currentTime = 0;
          console.log('🛑 Typing audio stopped - typing complete');
        }
      }, 50); // 50ms per character
    }

    function hideVideo3Background() {
      console.log('🛑 Hiding trailer video (bg-video3)...');
      const video = document.getElementById('bg-video3');
      const videoContainer = document.getElementById('video-container');
      
      // Check if FADELONG video is currently showing before hiding container
      const fadelongVideo = document.getElementById('bg-video-fadelong');
      const fadelongIsShowing = fadelongVideo && (
        window.getComputedStyle(fadelongVideo).display !== 'none' ||
        fadelongVideo.style.display === 'block'
      );
      
      if (video) {
        video.pause();
        video.currentTime = 0; // Reset to beginning
        video.style.setProperty('display', 'none', 'important');
      }
      
      // Only hide container if FADELONG is NOT showing
      if (videoContainer && !fadelongIsShowing) {
        console.log('🛑 Hiding video container (no other videos showing)');
        videoContainer.style.display = 'none';
      } else if (fadelongIsShowing) {
        console.log('✅ Keeping video container visible (FADELONG video is showing)');
      }
    }
    
    // Enhanced audio context initialization with debugging
    function initAudioContext() {
      if (debugMode) console.log('🔊 Initializing audio context...');
      
      if (!audioContext) {
        try {
          audioContext = new (window.AudioContext || window.webkitAudioContext)();
          console.log('✅ Audio context created successfully:', audioContext.state);
          
          // Resume audio context if suspended (required by Chrome)
          if (audioContext.state === 'suspended') {
            audioContext.resume().then(() => {
              console.log('✅ Audio context resumed from suspended state');
            }).catch(err => {
              console.error('❌ Failed to resume audio context:', err);
            });
          }
        } catch (e) {
          console.error('❌ Audio context creation failed:', e);
          audioEnabled = false;
          showAudioError('Audio not supported in this browser');
        }
      }
      return audioContext !== null;
    }
    
    // Show audio error in the UI
    function showAudioError(message) {
      const navMsg = document.getElementById('nav-msg');
      if (navMsg) {
        const originalText = navMsg.textContent;
        const originalVisibility = navMsg.style.visibility;
        
        navMsg.textContent = `AUDIO ERROR: ${message}`;
        navMsg.style.visibility = 'visible';
        navMsg.style.color = '#FF6666';
        
        setTimeout(() => {
          navMsg.textContent = originalText;
          navMsg.style.visibility = originalVisibility;
          navMsg.style.color = '';
        }, 3000);
      }
    }
    
    
    
    
    


    // Audio functions for pages 8 and 12 removed - defunct

    /* ================== PREP ================== */
    const fullText = fullTextRaw.toUpperCase();
    let pages = fullText.split(/\n{4,}/).filter(page => page.trim().length > 0);
    console.log('📄 Page 2 content:', pages[1] ? pages[1].substring(0, 100) : 'UNDEFINED');
    console.log('📄 Total pages created:', pages.length);
    console.log('📄 Pages:', pages.map((p, i) => `Page ${i + 1}: ${p.substring(0, 50)}...`));
    
    // Ensure we have at least 7 pages for trailer slide
    // Check if "IN 2025" content exists and ensure it's a separate page
    const in2025Index = pages.findIndex(p => p.includes('IN 2025, THE SIX BILLION DOLLAR MAN'));
    if (in2025Index === -1 || pages.length < 7) {
      console.log('⚠️ IN 2025 content not found as separate page, ensuring slide 7 exists...');
      // Find the last page and split it if it contains IN 2025
      if (pages.length > 0) {
        const lastPage = pages[pages.length - 1];
        if (lastPage.includes('IN 2025')) {
          // Split at IN 2025 if it's part of another page
          const in2025Split = lastPage.split(/\n{2,}/);
          const beforeIn2025 = in2025Split[0].trim();
          const in2025Content = in2025Split.slice(1).join('\n\n').trim();
          
          if (beforeIn2025 && in2025Content) {
            pages[pages.length - 1] = beforeIn2025;
            pages.push(in2025Content);
            console.log('✅ Split last page to create slide 7');
          }
        } else {
          // If no IN 2025 found, add an empty slide 7 that will show the trailer
          pages.push(''); // Empty page for trailer
          console.log('✅ Added empty slide 7 for trailer');
        }
      }
    }
    
    console.log('📄 Final total pages:', pages.length);
    
    // Debug: Show detailed content for each page
    pages.forEach((page, index) => {
      console.log(`📄 DETAILED Page ${index + 1} (${page.length} chars):`, page.substring(0, 200));
      if (page.includes('IN 2025, THE SIX BILLION DOLLAR MAN')) {
        console.log(`🎯 FOUND "IN 2025" content on page ${index + 1}`);
      }
    });
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 .,\'"?!-—:;\n';

    // Image mode constants and functions removed - no more image mode switching
    
    // Image mode functions removed - no more image mode switching
    
    // pageModes array removed - no more image mode switching
    
    
    // Image mode loading removed
    
    // Keyword scanning removed - no more image searches
    
    // Test audio functions removed - defunct
    
    

    // DOM
    const pageEl = document.getElementById('page');
    const textWrap = document.getElementById('text-wrap');
    const el = document.getElementById('unscramble');
    const promptElem = document.getElementById('prompt');
    const navMsg = document.getElementById('nav-msg');
    const slideCounterEl = document.getElementById('slide-counter');

    let currentPage = 0;
    let isAnimating = false;
    let currentInterval = null;
    let currentAnimationFrame = null;
    // availableKeywords removed - no more keyword searches
    let audioTimeout = null; // Track audio timeout
    let lineRevealTimeouts = []; // Track line reveal timeouts
    let isInLineRevealMode = false;
    let lineRevealState = { lines: [], currentIndex: 0, element: null, onComplete: null };
    let lastTouchTime = 0; // Track last touch time to prevent double-firing
    let filmByTimeouts = []; // Track 6BDM animation timeouts
    let currentTypingInterval = null; // Track the current subtitle typing interval
    let shouldContinueTyping = true; // Flag to control if typing should continue
    let audioContextUnlocked = false; // Track if audio context is unlocked
    let scramblingDisabled = false; // Track if scrambling should be disabled
    let videoStartTime = null; // Track when video started playing
    
    
    // Memory management
    let activeEventListeners = new Map(); // Track active event listeners
    let createdElements = new Set(); // Track created DOM elements
    
    // Memory management functions
    function addEventTracker(element, event, handler) {
      const key = `${element.id || element.tagName}-${event}`;
      if (!activeEventListeners.has(key)) {
        activeEventListeners.set(key, []);
      }
      activeEventListeners.get(key).push({ element, event, handler });
      element.addEventListener(event, handler);
    }
    
    function removeEventTracker(element, event, handler) {
      const key = `${element.id || element.tagName}-${event}`;
      if (activeEventListeners.has(key)) {
        const listeners = activeEventListeners.get(key);
        const index = listeners.findIndex(l => l.element === element && l.handler === handler);
        if (index > -1) {
          listeners.splice(index, 1);
          element.removeEventListener(event, handler);
          if (listeners.length === 0) {
            activeEventListeners.delete(key);
          }
        }
      }
    }
    
    function cleanupElement(element) {
      if (!element) return;
      
      // Remove all tracked event listeners
      const elementId = element.id || element.tagName;
      for (const [key, listeners] of activeEventListeners.entries()) {
        if (key.startsWith(elementId)) {
          listeners.forEach(({ element: el, event, handler }) => {
            if (el === element) {
              el.removeEventListener(event, handler);
            }
          });
          activeEventListeners.delete(key);
        }
      }
      
      // Remove from created elements set
      createdElements.delete(element);
      
      // Remove from DOM
      if (element.parentNode) {
        element.parentNode.removeChild(element);
      }
    }
    
    function cleanupUnusedElements() {
      // Clean up images that are not for current or next page
      const currentPageNumber = currentPage + 1;
      const nextPageNumber = currentPage + 2;
      
      document.querySelectorAll('#page img').forEach(img => {
        const imgId = img.id;
        if (imgId) {
          const pageNumber = parseInt(imgId.replace('img-', ''));
          if (pageNumber < currentPageNumber - 1 || pageNumber > nextPageNumber) {
            console.log(`🧹 Cleaning up unused image for page ${pageNumber}`);
            cleanupElement(img);
          }
        }
      });
      
      // Clean up old persistent text elements
      const oldPersistentText = document.getElementById('persistent-text');
      if (oldPersistentText && currentPage !== 4) { // Only keep on page 5 (index 4)
        cleanupElement(oldPersistentText);
      }
    }
    
    function clearAllTimeouts() {
      // Clear all tracked timeouts
      lineRevealTimeouts.forEach(timeout => clearTimeout(timeout));
      lineRevealTimeouts = [];
      
      filmByTimeouts.forEach(timeout => clearTimeout(timeout));
      filmByTimeouts = [];
      
      if (audioTimeout) {
        clearTimeout(audioTimeout);
        audioTimeout = null;
      }
      
      // Clear animation frames
      if (currentAnimationFrame) {
        cancelAnimationFrame(currentAnimationFrame);
        currentAnimationFrame = null;
      }
    }
    
    // Optimized animation functions using requestAnimationFrame
    function createRAFAnimation(callback, interval = 100) {
      let lastTime = 0;
      let animationId = null;
      
      function animate(currentTime) {
        if (currentTime - lastTime >= interval) {
          const shouldContinue = callback(currentTime - lastTime);
          lastTime = currentTime;
          
          if (shouldContinue === false) {
            currentAnimationFrame = null;
            return;
          }
        }
        
        animationId = requestAnimationFrame(animate);
        currentAnimationFrame = animationId;
      }
      
      animationId = requestAnimationFrame(animate);
      currentAnimationFrame = animationId;
      
      return () => {
        if (animationId) {
          cancelAnimationFrame(animationId);
          currentAnimationFrame = null;
        }
      };
    }

    // Simple image functions for slides 5 and 6 only
    function addCannesPhoto() {
      // Remove any existing images first
      removeAllImages();
      
      // Check if mobile
      const isMobile = window.innerWidth <= 768 || /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      
      // Create container for Cannes photo
      const imageContainer = document.createElement('div');
      imageContainer.id = 'cannes-photo-container';
      imageContainer.style.cssText = `
        position: fixed !important;
        bottom: ${isMobile ? '25vh' : '20vh'} !important;
        left: 50% !important;
        transform: translateX(-50%) !important;
        max-width: ${isMobile ? '60vw' : '40vw'} !important;
        max-height: ${isMobile ? '28vh' : '20vh'} !important;
        width: ${isMobile ? '60vw' : '40vw'} !important;
        height: auto !important;
        z-index: 1 !important;
        pointer-events: none !important;
        overflow: visible !important;
        transition: opacity 0.15s ease-in-out !important;
      `;
      document.body.appendChild(imageContainer);
      
      // Add Cannes photo
      const img = document.createElement('img');
      img.id = 'cannes-photo';
      img.src = 'PHOTOS/photo_cannes.png.jpeg';
      img.style.cssText = `
        width: 100% !important;
        height: 100% !important;
        max-width: none !important;
        max-height: none !important;
        object-fit: contain !important;
        filter: brightness(0.8) sepia(1) hue-rotate(60deg) saturate(4.0) !important;
        display: block !important;
        opacity: 0 !important;
        transition: opacity 0.4s ease-in-out !important;
      `;
      imageContainer.appendChild(img);
      
      // Quick fade-in effect
      imageContainer.style.opacity = '0';
      setTimeout(() => {
        imageContainer.style.opacity = '1';
        img.style.opacity = '1';
        // Add brightness flash effect with intense glow
        img.style.filter = 'brightness(1.2) sepia(1) hue-rotate(60deg) saturate(4.0)';
        img.style.boxShadow = 'inset 0 0 50px rgba(0, 255, 0, 0.6), 0 0 30px rgba(0, 255, 0, 0.4)';
        setTimeout(() => {
          img.style.filter = 'brightness(0.8) sepia(1) hue-rotate(60deg) saturate(4.0)';
          img.style.boxShadow = 'none';
        }, 200);
      }, 50);
      
      console.log('Cannes photo added to slide 5');
    }
    
    function addArrestPhoto() {
      // Remove any existing images first
      removeAllImages();
      
      // Check if mobile
      const isMobile = window.innerWidth <= 768 || /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      
      // Create container for Arrest photo
      const imageContainer = document.createElement('div');
      imageContainer.id = 'arrest-photo-container';
      imageContainer.style.cssText = `
        position: fixed !important;
        bottom: ${isMobile ? '25vh' : '20vh'} !important;
        left: 50% !important;
        transform: translateX(-50%) !important;
        max-width: ${isMobile ? '60vw' : '40vw'} !important;
        max-height: ${isMobile ? '28vh' : '20vh'} !important;
        width: ${isMobile ? '60vw' : '40vw'} !important;
        height: auto !important;
        z-index: 1 !important;
        pointer-events: none !important;
        overflow: visible !important;
        transition: opacity 0.15s ease-in-out !important;
      `;
      document.body.appendChild(imageContainer);
      
      // Add Arrest photo
      const img = document.createElement('img');
      img.id = 'arrest-photo';
      img.src = 'PHOTOS/photo_arrest.webp';
      img.style.cssText = `
        width: 100% !important;
        height: 100% !important;
        max-width: none !important;
        max-height: none !important;
        object-fit: contain !important;
        filter: brightness(0.8) sepia(1) hue-rotate(60deg) saturate(4.0) !important;
        display: block !important;
        opacity: 0 !important;
        transition: opacity 0.4s ease-in-out !important;
      `;
      imageContainer.appendChild(img);
      
      // Quick fade-in effect
      imageContainer.style.opacity = '0';
      setTimeout(() => {
        imageContainer.style.opacity = '1';
        img.style.opacity = '0.4';
      }, 50);
      
      console.log('Arrest photo added to slide 5');
    }
    
    function addCollateralPhoto() {
      // Remove any existing images first
      removeAllImages();
      
      // Check if mobile
      const isMobile = window.innerWidth <= 768 || /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      
      // Create container for Collateral photo
      const imageContainer = document.createElement('div');
      imageContainer.id = 'collateral-photo-container';
      imageContainer.style.cssText = `
        position: fixed !important;
        bottom: ${isMobile ? '22vh' : '18vh'} !important;
        left: 50% !important;
        transform: translateX(-50%) !important;
        max-width: ${isMobile ? '75vw' : '50vw'} !important;
        max-height: ${isMobile ? '35vh' : '25vh'} !important;
        width: ${isMobile ? '75vw' : '50vw'} !important;
        height: auto !important;
        z-index: 1 !important;
        pointer-events: none !important;
        overflow: visible !important;
        transition: opacity 0.15s ease-in-out !important;
      `;
      
      // Add desktop-only styling with higher specificity
      const style = document.createElement('style');
      style.textContent = `
        @media (min-width: 769px) {
          #collateral-photo-container {
            z-index: 0 !important;
          }
          #collateral-photo {
            display: block !important;
            opacity: 0.35 !important;
            filter: brightness(0.8) sepia(1) hue-rotate(60deg) saturate(4.0) !important;
          }
        }
        @media (max-width: 768px) {
          #collateral-photo-container {
            z-index: 1 !important;
          }
          #collateral-photo {
            display: block !important;
            opacity: 0.35 !important;
            filter: brightness(0.8) sepia(1) hue-rotate(60deg) saturate(4.0) !important;
          }
        }
        /* Override any conflicting CSS rules */
        #collateral-photo-container #collateral-photo {
          display: block !important;
          position: relative !important;
        }
      `;
      document.head.appendChild(style);
      document.getElementById('page').appendChild(imageContainer);
      
      // Add Collateral photo
      const img = document.createElement('img');
      img.id = 'collateral-photo';
      img.src = 'PHOTOS/photo_collateral_crop.jpg';
      img.style.cssText = `
        width: 100% !important;
        height: 100% !important;
        max-width: none !important;
        max-height: none !important;
        object-fit: contain !important;
        filter: brightness(0.5) sepia(1) hue-rotate(60deg) saturate(4.0) !important;
        display: block !important;
        opacity: 0 !important;
        transition: opacity 0.4s ease-in-out !important;
      `;
      imageContainer.appendChild(img);
      
      // Quick fade-in effect
      imageContainer.style.opacity = '0';
      setTimeout(() => {
        imageContainer.style.opacity = '1';
        img.style.opacity = '1';
        // Add brightness flash effect with intense glow
        img.style.filter = 'brightness(0.7) sepia(1) hue-rotate(60deg) saturate(4.0)';
        img.style.boxShadow = 'inset 0 0 50px rgba(0, 255, 0, 0.6), 0 0 30px rgba(0, 255, 0, 0.4)';
        setTimeout(() => {
          img.style.filter = 'brightness(0.5) sepia(1) hue-rotate(60deg) saturate(4.0)';
          img.style.boxShadow = 'none';
        }, 200);
      }, 50);
      
      console.log('Collateral photo added - should be behind text and dimmed on desktop');
      console.log('Desktop z-index: collateral=0, text=1');
      console.log('Mobile z-index: collateral=1, text=1');
    }
    
    function addCorreaPhoto() {
      // Remove any existing images first
      removeAllImages();
      
      // Check if mobile
      const isMobile = window.innerWidth <= 768 || /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      
      // Create container for Correa photo
      const imageContainer = document.createElement('div');
      imageContainer.id = 'correa-photo-container';
      imageContainer.style.cssText = `
        position: fixed !important;
        bottom: ${isMobile ? '25vh' : '20vh'} !important;
        left: 50% !important;
        transform: translateX(-50%) !important;
        max-width: ${isMobile ? '60vw' : '40vw'} !important;
        max-height: ${isMobile ? '28vh' : '20vh'} !important;
        width: ${isMobile ? '60vw' : '40vw'} !important;
        height: auto !important;
        z-index: 1 !important;
        pointer-events: none !important;
        overflow: visible !important;
        transition: opacity 0.15s ease-in-out !important;
      `;
      document.body.appendChild(imageContainer);
      
      // Add Correa photo
      const img = document.createElement('img');
      img.id = 'correa-photo';
      img.src = 'PHOTOS/photo_correa.jpg';
      img.style.cssText = `
        width: 100% !important;
        height: 100% !important;
        max-width: none !important;
        max-height: none !important;
        object-fit: contain !important;
        filter: brightness(0.8) sepia(1) hue-rotate(60deg) saturate(4.0) !important;
        display: block !important;
        opacity: 0 !important;
        transition: opacity 0.4s ease-in-out !important;
      `;
      imageContainer.appendChild(img);
      
      // Quick fade-in effect
      imageContainer.style.opacity = '0';
      setTimeout(() => {
        imageContainer.style.opacity = '1';
        img.style.opacity = '0.6';
      }, 50);
      
      console.log('Correa photo added to slide 4');
    }
    
    
    function removeAllImages() {
      // Quick fade out all image containers
      const containers = [
        document.getElementById('cannes-photo-container'),
        document.getElementById('arrest-photo-container'),
        document.getElementById('correa-photo-container'),
        document.getElementById('collateral-photo-container')
      ];
      
      containers.forEach(container => {
        if (container) {
          container.style.opacity = '0';
          setTimeout(() => container.remove(), 150);
        }
      });
      
      // Remove 6BDM subtitle element
      const bdmSubtitle = document.getElementById('bdm-subtitle');
      if (bdmSubtitle) {
        bdmSubtitle.remove();
      }
      
      // Remove any other images
      document.querySelectorAll('#page img').forEach(img => {
        img.remove();
      });
    }
    
    
    // Image mode functions removed - no more text container adjustments
    
    
    // Complex image search functions removed

    
      function truncateTextToFit(element, text) {
      // Simply set the content without dynamic page splitting
      element.textContent = text;
      }

    /* ================== SCRAMBLE ================== */
    
    // Function to type subtitle text character by character (typewriter effect)
    function decodeSubtitle(element, baseText, subtitleText, onComplete) {
      // Check if we should even start typing (page might have changed)
      if (!shouldContinueTyping) {
        console.log('🛑 Typing cancelled - page navigation detected');
        return;
      }
      
      // Clear any existing typing animation first
      if (currentTypingInterval) {
        clearInterval(currentTypingInterval);
        currentTypingInterval = null;
        console.log('🧹 Cleared previous typing animation');
      }
      
      let charIndex = 0;
      const len = subtitleText.length;
      
      console.log('Starting subtitle typewriter animation...');
      
      currentTypingInterval = setInterval(() => {
        // Check if we should continue typing
        if (!shouldContinueTyping) {
          console.log('🛑 Typing cancelled mid-animation');
          clearInterval(currentTypingInterval);
          currentTypingInterval = null;
          return;
        }
        
        // Show characters up to current index
        const currentText = subtitleText.substring(0, charIndex + 1);
        
        // Check if this is the 6BDM text and format it with different sizes
        if (subtitleText.includes('6BDM:') && subtitleText.includes('JULIAN ASSANGE')) {
          const parts = currentText.split('\n');
          if (parts.length > 1) {
            element.innerHTML = parts[0] + '<br><span style="font-size: 0.75em;">' + parts[1] + '</span>';
          } else {
            element.textContent = currentText;
          }
        } else {
        element.textContent = baseText + currentText;
        }
        
        
        charIndex++;
        if (charIndex >= len) {
          clearInterval(currentTypingInterval);
          currentTypingInterval = null;
          // Final clean text with formatting
          if (subtitleText.includes('6BDM:') && subtitleText.includes('JULIAN ASSANGE')) {
            const parts = subtitleText.split('\n');
            element.innerHTML = parts[0] + '<br><span style="font-size: 0.75em;">' + parts[1] + '</span>';
          } else {
            element.textContent = baseText + subtitleText;
          }
          console.log('Subtitle typewriter complete');
          if (shouldContinueTyping) { // Only call onComplete if we weren't cancelled
          onComplete && onComplete();
          }
        }
      }, 50); // 50ms per character for smooth typewriter effect
    }
    
    
    // Mobile text wrapping function - breaks long lines intelligently while preserving formatting
    function wrapTextForMobile(text) {
      const isMobile = window.innerWidth <= 768;
      if (!isMobile) return text;
      
      const lines = text.split('\n');
      const wrappedLines = [];
      const maxLineLength = 40; // Shorter for better mobile readability
      
      for (const line of lines) {
        if (line.length <= maxLineLength) {
          // Short lines stay as-is
          wrappedLines.push(line);
        } else {
          // Long lines need wrapping
          const indent = line.match(/^(\s*)/)?.[1] || '';
          const hasBullet = line.match(/^(\s*>\s*)/)?.[1] || '';
          const content = line.replace(/^(\s*>\s*)/, '');
          
          if (content.length <= maxLineLength) {
            wrappedLines.push(line);
          } else {
            // Break at natural points (spaces, punctuation)
            const words = content.split(' ');
            let currentLine = indent + hasBullet;
            let isFirstLine = true;
            
            for (const word of words) {
              const testLine = currentLine + (currentLine.endsWith(indent + hasBullet) ? '' : ' ') + word;
              
              if (testLine.length > maxLineLength) {
                if (currentLine.trim() !== (indent + hasBullet).trim()) {
                  wrappedLines.push(currentLine);
                  // For continuation lines, only add spaces, not the bullet
                  currentLine = indent + '  ' + word;
                  isFirstLine = false;
                } else {
                  currentLine += word;
                }
              } else {
                currentLine += (currentLine.endsWith(indent + hasBullet) ? '' : ' ') + word;
              }
            }
            
            if (currentLine.trim() !== (indent + hasBullet).trim()) {
              wrappedLines.push(currentLine);
            }
          }
        }
      }
      
      return wrappedLines.join('\n');
    }

    // Function to wrap years in spans for styling
    function wrapYearsInSpans(element) {
      if (!element) return;
      
      // Get the text content
      let text = element.textContent;
      
      // Regular expression to match years in format YYYY: or YYYY-YYYY:
      const yearRegex = /(\d{4}(?:-\d{4})?):/g;
      
      // Replace years with wrapped spans
      const wrappedText = text.replace(yearRegex, '<span class="year-text">$1:</span>');
      
      // Set the innerHTML with the wrapped text
      element.innerHTML = wrappedText;
    }

    function scrambleFastChunks(element, text, onComplete) {
      // Check if scrambling is disabled or if we're after slide 3
      if (scramblingDisabled || currentPage > 2) {
        console.log('🔒 Scrambling disabled - displaying text instantly (after slide 3)');
        element.textContent = text;
        wrapYearsInSpans(element);
        onComplete && onComplete();
        return;
      }
      
      if (currentInterval) {
        clearInterval(currentInterval);
        currentInterval = null;
      }
      
      if (currentAnimationFrame) {
        cancelAnimationFrame(currentAnimationFrame);
        currentAnimationFrame = null;
      }
      
      // Apply mobile text wrapping before processing (skip slides 5-6)
      if (currentPage !== 4 && currentPage !== 5) {
        text = wrapTextForMobile(text);
      }
      
      let index = 0, chunkSize = 15, scrambled = text.split(''), len = text.length;
      for (let i=0;i<len;i++) scrambled[i] = /\s/.test(text[i]) ? text[i] : chars[Math.floor(Math.random()*chars.length)];
      isAnimating = true; promptElem.style.visibility='hidden'; navMsg.style.visibility='hidden';

      // Stop any existing typing audio
      if (typingAudio) {
        typingAudio.pause();
        typingAudio = null;
      }
      
      // Only play unscramble audio on slide 2 (pageIndex 1)
      if (currentPage === 1) {
        // Play unscramble audio for slide 2 only
        const unscrambleAudioEl = document.getElementById('unscramble-audio');
        if (unscrambleAudioEl) {
          unscrambleAudioEl.volume = 0.3;
          unscrambleAudioEl.loop = true;
          unscrambleAudioEl.muted = false;
          
          console.log('🔊 Playing unscramble audio...');
          unscrambleAudioEl.play().then(() => {
            console.log('✅ Unscramble audio playing');
          }).catch(err => {
            console.log('❌ Unscramble audio play failed:', err);
          });
        }
      } else {
        console.log('🔇 Skipping unscramble audio - not on slide 2');
      }

      // Use requestAnimationFrame for better performance
      const stopAnimation = createRAFAnimation(() => {
        const display = scrambled.slice();
        for (let i=0;i<index;i++){
          let s=i*chunkSize, e=Math.min(s+chunkSize,len);
          for (let j=s;j<e;j++) display[j]=text[j];
        }
        for (let k=index*chunkSize;k<len;k++) display[k] = /\s/.test(text[k]) ? text[k] : chars[Math.floor(Math.random()*chars.length)];
        element.textContent = display.join('');

        index++;
        if ((index*chunkSize)>=len){
          stopAnimation();
          truncateTextToFit(element, text);
          isAnimating=false;
          
          // Stop typing audio
          if (typingAudio) {
            console.log('🛑 Stopping typing audio');
            typingAudio.pause();
            typingAudio.currentTime = 0;
            typingAudio = null;
          }
          
          // Stop unscramble audio
          const unscrambleAudioStop2 = document.getElementById('unscramble-audio');
          if (unscrambleAudioStop2) {
            unscrambleAudioStop2.pause();
            unscrambleAudioStop2.currentTime = 0;
            console.log('🔇 Unscramble audio stopped');
          }
          
          // Wrap years in spans for styling
          wrapYearsInSpans(element);
          
          // Navigation messages are now handled in startPage function
          
          // Check if this text contains "A FILM BY" and show video
          if (text.includes('A FILM BY EUGENE JARECKI')) {
            console.log('A FILM BY detected - showing video...');
            
            // Show video
            showVideo3Background();
            
            // Hide the text element since video will show everything
            element.textContent = '';
            
                  onComplete && onComplete();
              } else {
                onComplete && onComplete();
              }
          
          // Stop unscramble audio when animation completes
          const unscrambleAudioStop = document.getElementById('unscramble-audio');
          if (unscrambleAudioStop) {
            unscrambleAudioStop.pause();
            unscrambleAudioStop.currentTime = 0;
            console.log('🔇 Unscramble audio stopped');
          }
          
          return false; // Stop animation
        }
        return true; // Continue animation
      }, 100);
    }

    // Ultra-fast scrambling specifically for 2006 text - much faster interval
    function scrambleUltraFastChunks(element, text, onComplete) {
      // Check if scrambling is disabled or if we're after slide 3
      if (scramblingDisabled || currentPage > 2) {
        console.log('🔒 Scrambling disabled - displaying text instantly (after slide 3)');
        element.textContent = text;
        wrapYearsInSpans(element);
        onComplete && onComplete();
        return;
      }
      
      if (currentInterval) {
        clearInterval(currentInterval);
        currentInterval = null;
      }
      
      if (currentAnimationFrame) {
        cancelAnimationFrame(currentAnimationFrame);
        currentAnimationFrame = null;
      }
      
      // Apply mobile text wrapping before processing (skip slides 5-6)
      if (currentPage !== 4 && currentPage !== 5) {
        text = wrapTextForMobile(text);
      }
      
      let index = 0, chunkSize = 15, scrambled = text.split(''), len = text.length;
      for (let i=0;i<len;i++) scrambled[i] = /\s/.test(text[i]) ? text[i] : chars[Math.floor(Math.random()*chars.length)];
      isAnimating = true; promptElem.style.visibility='hidden'; navMsg.style.visibility='hidden';

      // Stop any existing typing audio
      if (typingAudio) {
        typingAudio.pause();
        typingAudio = null;
      }
      
      // Only play unscramble audio on slide 2 (pageIndex 1)
      if (currentPage === 1) {
        // Play unscramble audio for slide 2 only (ultra-fast)
        const unscrambleAudioEl2 = document.getElementById('unscramble-audio');
        if (unscrambleAudioEl2) {
          unscrambleAudioEl2.volume = 0.3;
          unscrambleAudioEl2.loop = true;
          unscrambleAudioEl2.muted = false;
          
          console.log('🔊 Playing unscramble audio (ultra-fast)...');
          unscrambleAudioEl2.play().then(() => {
            console.log('✅ Unscramble audio playing');
          }).catch(err => {
            console.log('❌ Unscramble audio play failed:', err);
          });
        }
      } else {
        console.log('🔇 Skipping unscramble audio - not on slide 2');
      }

      // Use requestAnimationFrame for better performance with ultra-fast timing
      const stopAnimation = createRAFAnimation(() => {
        const display = scrambled.slice();
        for (let i=0;i<index;i++){
          let s=i*chunkSize, e=Math.min(s+chunkSize,len);
          for (let j=s;j<e;j++) display[j]=text[j];
        }
        for (let k=index*chunkSize;k<len;k++) display[k] = /\s/.test(text[k]) ? text[k] : chars[Math.floor(Math.random()*chars.length)];
        element.textContent = display.join('');

        index++;
        if ((index*chunkSize)>=len){
          stopAnimation();
          truncateTextToFit(element, text);
          isAnimating=false;
          
          // Stop typing audio
          if (typingAudio) {
            console.log('🛑 Stopping typing audio');
            typingAudio.pause();
            typingAudio.currentTime = 0;
            typingAudio = null;
          }
          
          // Stop unscramble audio
          const unscrambleAudioStop2 = document.getElementById('unscramble-audio');
          if (unscrambleAudioStop2) {
            unscrambleAudioStop2.pause();
            unscrambleAudioStop2.currentTime = 0;
            console.log('🔇 Unscramble audio stopped');
          }
          
          // Wrap years in spans for styling
          wrapYearsInSpans(element);
          
          // Navigation messages are now handled in startPage function
          
          onComplete && onComplete();
          return false; // Stop animation
        }
        return true; // Continue animation
      }, 25); // Ultra-fast: 25ms interval instead of 100ms (4x faster)
    }

    
    

    /* ================== LINE BY LINE REVEAL ================== */
    function revealLineByLine(element, text, onComplete) {
      // Clear any existing intervals and timeouts
      if (currentInterval) {
        clearInterval(currentInterval);
        currentInterval = null;
      }
      
      // Clear any existing line reveal timeouts
      lineRevealTimeouts.forEach(timeout => clearTimeout(timeout));
      lineRevealTimeouts = [];
      
      isAnimating = true;
      isInLineRevealMode = true;
      promptElem.style.visibility = 'hidden';
      
      const lines = text.split('\n').filter(line => line.trim() !== ''); // Remove empty lines
      element.textContent = '';
      
      // Set up line reveal state
      lineRevealState = {
        lines: lines,
        currentIndex: 0,
        element: element,
        onComplete: onComplete
      };
      
      console.log('Starting manual line-by-line reveal for 2006-2024 content...');
      console.log(`Total lines to reveal: ${lines.length}`);
      
      // Show the first line immediately
      showNextLineManual();
    }
    
    function showNextLineManual() {
      if (lineRevealState.currentIndex < lineRevealState.lines.length) {
        const currentLine = lineRevealState.lines[lineRevealState.currentIndex];
        const lineNumber = lineRevealState.currentIndex + 1;
        
        // Determine if this line should be decoded (only first line - first item only)
        const shouldDecode = lineRevealState.currentIndex === 0;
        
        if (shouldDecode) {
          console.log(`Decoding line ${lineNumber}: "${currentLine}"`);
          
          // Get current content before this line
          let previousContent = '';
          if (lineRevealState.currentIndex > 0) {
            previousContent = lineRevealState.element.textContent + '\n\n';
          }
          
          // Display line instantly
          lineRevealState.element.textContent = previousContent + currentLine;
          setTimeout(() => {
            lineRevealState.currentIndex++;
            
            // Check if we're done
            if (lineRevealState.currentIndex >= lineRevealState.lines.length) {
              console.log('All lines revealed, finishing...');
              isAnimating = false;
              isInLineRevealMode = false;
              lineRevealState.onComplete && lineRevealState.onComplete();
            } else {
              // Show navigation message for manual progression (even after decoded lines)
              navMsg.innerHTML = 'PRESS SPACEBAR<br>TO ENTER';
              navMsg.style.fontSize = '0.9rem';
              navMsg.style.textAlign = 'center';
              navMsg.style.visibility = 'visible';
            }
          }, 50);
        } else {
          // Show instantly for later lines (no decoding)
          if (lineRevealState.currentIndex > 0) {
            lineRevealState.element.textContent += '\n\n';
          }
          lineRevealState.element.textContent += currentLine;
          
          console.log(`Instantly revealed line ${lineNumber}: "${currentLine}"`);
          lineRevealState.currentIndex++;
          
          // Show navigation message for manual progression
          navMsg.innerHTML = 'press spacebar<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to enter';
          navMsg.style.fontSize = '0.9rem';
          navMsg.style.visibility = 'visible';
          
          if (lineRevealState.currentIndex >= lineRevealState.lines.length) {
            // All lines revealed
            console.log('All lines revealed, finishing...');
            isAnimating = false;
            isInLineRevealMode = false;
            lineRevealState.onComplete && lineRevealState.onComplete();
          }
        }
      }
    }

         /* ================== PAGE RENDER ================== */
  function startPage(pageIndex){
        if (pageIndex >= pages.length) pageIndex = 0;
        if (pageIndex < 0) pageIndex = pages.length - 1;
        
        const pageEl = document.getElementById('page');
        const el = document.getElementById('unscramble');
        const promptElem = document.getElementById('prompt');
        
        // Only animate if not first load
        if (currentPage !== null && currentPage !== pageIndex) {
          // Determine direction (forward or backward)
          const goingForward = pageIndex > currentPage;
          
          // Remove all animation classes
          pageEl.classList.remove('slide-in-right', 'slide-in-left', 'slide-out-left', 'slide-out-right');
          
          // Trigger slide-out animation based on direction
          if (goingForward) {
            pageEl.classList.add('slide-out-left');
          } else {
            pageEl.classList.add('slide-out-right');
          }
          
          // Wait for slide-out to complete, then update content and slide in
          setTimeout(() => {
        currentPage = pageIndex;
            
            // Stop unscramble audio
          const unscrambleAudioStop2 = document.getElementById('unscramble-audio');
          if (unscrambleAudioStop2) {
            unscrambleAudioStop2.pause();
            unscrambleAudioStop2.currentTime = 0;
            console.log('🔇 Unscramble audio stopped');
          }
        
        console.log(`🔍 Starting page ${pageIndex + 1}, content:`, pages[pageIndex] ? pages[pageIndex].substring(0, 100) : 'UNDEFINED');
        console.log(`🔍 DEBUG: Page ${pageIndex + 1} full content length:`, pages[pageIndex] ? pages[pageIndex].length : 0);
        console.log(`🔍 DEBUG: Total pages available:`, pages.length);
        
            // Update content (rest of function)
            continuePageSetup(pageIndex, pageEl, el, promptElem);
            
            // Trigger slide-in animation based on direction
            pageEl.classList.remove('slide-out-left', 'slide-out-right');
            if (goingForward) {
              pageEl.classList.add('slide-in-right');
            } else {
              pageEl.classList.add('slide-in-left');
            }
            
            // Remove animation class after completion
            setTimeout(() => {
              pageEl.classList.remove('slide-in-right', 'slide-in-left');
            }, 250);
          }, 250);
          
          return; // Exit early, will continue after animation
        }
        
        // First load - no animation
        currentPage = pageIndex;
        
        console.log(`🔍 Starting page ${pageIndex + 1}, content:`, pages[pageIndex] ? pages[pageIndex].substring(0, 100) : 'UNDEFINED');
        console.log(`🔍 DEBUG: Page ${pageIndex + 1} full content length:`, pages[pageIndex] ? pages[pageIndex].length : 0);
        console.log(`🔍 DEBUG: Total pages available:`, pages.length);
        
        continuePageSetup(pageIndex, pageEl, el, promptElem);
  }
  
  function continuePageSetup(pageIndex, pageEl, el, promptElem) {
        // Clear all timeouts and intervals
        clearAllTimeouts();
        
        
        // Clear any ongoing typing animation
        if (currentTypingInterval) {
          clearInterval(currentTypingInterval);
          currentTypingInterval = null;
        }
        
        // Stop any typing animations that might be about to start
        shouldContinueTyping = false;
        
        // Clear any running scrambling animation
        if (currentInterval) {
          clearInterval(currentInterval);
          currentInterval = null;
        }
        
        // Clean up unused DOM elements and event listeners
        cleanupUnusedElements();
        
        // Reset animation state
        isAnimating = false;
        
        // Reset line reveal mode
        isInLineRevealMode = false;
        
        
        // Set data-page attribute for CSS targeting
        pageEl.setAttribute('data-page', pageIndex + 1);
        
       
      // Use simple, consistent font sizing - smaller on mobile
        const isMobile = window.innerWidth <= 768;
        
        // Set consistent text size for all slides
        el.style.fontSize = isMobile ? '0.8rem' : '1.2rem';
        
        el.style.paddingBottom = ''; // Reset any padding
       
       // Show text for all pages
       if (pageIndex < pages.length) {
         const textWrap = document.getElementById('text-wrap');
         if (textWrap) {
           textWrap.style.display = 'block';
         }
         
         el.textContent='';
         isAnimating = false;
         
         // Animation classes removed
         
        // Collateral Murder slide detection removed
         
          // Use faster scrambling for page 0
          if (pageIndex === 0) {
            // Instant display for page 0 to speed up initial load
            el.textContent = isMobile ? wrapTextForMobile(pages[pageIndex]) : pages[pageIndex];
            // Wrap years in spans for styling
            wrapYearsInSpans(el);
             // Collateral Murder slide animation removed
         } else if (pageIndex === 6) {
           // Slide 7 (trailer video slide) - no text, just video
           console.log(`🎬 Trailer slide ${pageIndex + 1}: Clearing text, showing video only`);
           el.textContent = '';
           // Hide text wrap on trailer slide
           const textWrap = document.getElementById('text-wrap');
           if (textWrap) {
             textWrap.style.display = 'none';
           }
         } else if (pageIndex === 1) {
           // Slide 2 - wait for slide animation to complete before unscrambling
           console.log(`🎯 SLIDE 2: Waiting for slide animation to complete before unscrambling`);
           el.textContent = '';
           // Wait for slide animation to complete (750ms total: 250ms slide-out + 250ms delay + 250ms slide-in)
           setTimeout(() => {
             console.log(`🎯 SCRAMBLE: Starting delayed unscrambling for slide ${pageIndex + 1}:`, pages[pageIndex].substring(0, 100));
             scrambleFastChunks(el, pages[pageIndex], () => {
               // Text displayed
               console.log(`✅ Slide 2 unscrambling completed`);
             });
           }, 750);
         } else {
           console.log(`🎯 SCRAMBLE: Displaying content for slide ${pageIndex + 1}:`, pages[pageIndex].substring(0, 100));
           scrambleFastChunks(el, pages[pageIndex], () => {
           // Text displayed
           // Collateral Murder slide animation removed
         });
           }
       }
       
      // Handle specific images for different slides
      console.log(`🖼️ DEBUG: Checking images for pageIndex ${pageIndex} (slide ${pageIndex + 1})`);
      if (pageIndex === 3) { // Slide 4 - Correa photo
        console.log(`🖼️ DEBUG: Adding Correa photo for slide 4`);
        addCorreaPhoto();
      } else if (pageIndex === 4) { // Slide 5 - Arrest photo
        console.log(`🖼️ DEBUG: Adding Arrest photo for slide 5`);
        addArrestPhoto();
      } else {
        console.log(`🖼️ DEBUG: Removing all images for slide ${pageIndex + 1}`);
        // Remove any existing images for other slides
        removeAllImages();
      }
       
       
      // Audio removed from last slide
       
       // Audio disabled - no sounds
       if (pageIndex + 1 === 7) {
         console.log('🔇 Audio disabled for page 7');
       }
       
       // Audio disabled - no sounds
       if (pageIndex + 1 === 10) {
         console.log('🔇 Audio disabled for page 10');
       }
       
       // Audio disabled - no sounds
       if (pageIndex + 1 === 9) {
         console.log('🔇 Audio disabled for page 9');
       }
       
       // Audio disabled - no sounds
       if (pageIndex + 1 === 13) {
         console.log('🔇 Audio disabled for page 13');
       }
       
      // Audio disabled - no sounds
      if (pageIndex + 1 === 15) {
        console.log('🔇 Audio disabled for page 15');
      }
       
       // Show FADELONG_mobile video on slide 3
       console.log(`🔍 Debug: Current page ${pageIndex + 1}, checking for FADELONG video on slide 3...`);
       if (pageIndex + 1 === 3) {
         console.log(`🎬 SLIDE 3 - Showing FADELONG_mobile video...`);
         document.body.classList.add('video-slide-active');
         showFadelongVideo();
       } else {
         hideFadelongVideo();
       }
       
       // Show video on slide 7 (trailer)
       console.log(`🔍 Debug: Current page ${pageIndex + 1}, checking for video on slide 7...`);
       if (pageIndex + 1 === 7) {
         console.log(`🎬 SLIDE 7 - Showing trailer...`);
         document.body.classList.add('video-slide-active');
         showVideo3Background();
         
         const video = document.getElementById('bg-video3');
         const videoContainer = document.getElementById('video-container');
         
         if (pageIndex + 1 === 7) {
           // Trailer video on slide 7 - uses its own built-in audio
           document.body.classList.add('trailer-slide');
           
           if (video && videoContainer) {
             // Detect if we're on GitHub Pages vs local
             const isLocal = window.location.protocol === 'file:' || 
                            window.location.hostname === 'localhost' || 
                            window.location.hostname === '127.0.0.1' ||
                            window.location.hostname.includes('127.0.0.1');
             
             // GitHub Pages doesn't serve Git LFS files, use raw GitHub URL
             // For local, use relative path
             if (isLocal) {
               video.src = 'VIDEOS/TRAILER.mp4';
               console.log('🎬 Using local TRAILER path');
             } else {
               // Use GitHub raw URL for LFS files on GitHub Pages
               video.src = 'https://github.com/CSFILMS/6BDMCLEAN/raw/main/VIDEOS/TRAILER.mp4';
               console.log('🎬 Using GitHub raw URL for TRAILER (LFS file)');
             }
             
             videoContainer.style.display = 'flex';
             videoContainer.style.pointerEvents = 'auto';
             videoContainer.style.top = '15vh';
             videoContainer.style.bottom = 'auto';
             
             
             // Trailer uses its own built-in audio (no separate audio track)
             video.muted = false;
             video.volume = 1.0;
             video.setAttribute('controls', 'true');
             video.setAttribute('playsinline', 'true');
             
             // Add error handler for video load failures
             video.addEventListener('error', (e) => {
               console.error('❌ TRAILER video load error:', e);
               console.error('❌ Video error code:', video.error ? video.error.code : 'unknown');
               console.error('❌ Video src tried:', video.src);
             }, { once: true });
             
             video.load();
             
             console.log('🎬 TRAILER video ready (using built-in audio)');
           }
         }
       } else {
         console.log(`🎬 Not slide 7 (current: ${pageIndex + 1}), hiding trailer...`);
         document.body.classList.remove('trailer-slide');
         
         // Hide trailer video on other pages (but not on slide 3 where FADELONG is showing)
         if (pageIndex + 1 !== 3) {
           hideVideo3Background();
         } else {
           console.log('✅ Skipping hideVideo3Background on slide 3 (FADELONG video is showing)');
         }
         if (typeof videoStartTime !== 'undefined') {
           videoStartTime = null; // Reset video timing when leaving video slide
         }
       }
       
       // Update nav message and slide counter
       const navMsg = document.getElementById('nav-msg');
       const slideCounter = document.getElementById('slide-counter');
       
       if (pageIndex <= 1) {
         // Slides 1-2: Show PRESS SPACEBAR in nav-msg, hide slide counter
         if (navMsg) {
           navMsg.innerHTML = 'PRESS SPACEBAR<br>TO CONTINUE';
           navMsg.style.fontSize = '0.7rem';
           navMsg.style.textAlign = 'center';
           navMsg.style.visibility = 'visible';
           navMsg.style.minWidth = '120px';
           navMsg.style.maxWidth = '140px';
           navMsg.style.lineHeight = '1.3';
           navMsg.style.whiteSpace = 'normal';
         }
         if (slideCounter) {
           slideCounter.style.visibility = 'hidden';
         }
       } else {
         // Slide 3 onwards: Show slide counter in nav-msg area, hide bottom counter
         if (navMsg) {
           navMsg.textContent = `SLIDE ${pageIndex + 1} / ${pages.length}`;
           navMsg.style.fontSize = '0.7rem';
           navMsg.style.textAlign = 'center';
           navMsg.style.visibility = 'visible';
           navMsg.style.minWidth = '100px';
           navMsg.style.maxWidth = '140px';
           navMsg.style.whiteSpace = 'nowrap';
         }
         if (slideCounter) {
           slideCounter.style.visibility = 'hidden';
         }
       }
       console.log(`📊 Navigation updated for page ${pageIndex + 1}`);
       
       // video2 handling removed - defunct
     }

    // createPersistentText function removed - no more duplicate text

    /* ================== NAV ================== */
    let lastAdvance = 0;
    let isNavigating = false;
    function throttle(){ const now=Date.now(); if (now-lastAdvance<600) return false; lastAdvance=now; return true; }
    function safeAdvance(){ 
      if (!throttle() || isNavigating) return; 
      
      unlockAudioContext(); 
      isNavigating = true;
      startPage(currentPage+1); 
      setTimeout(() => { isNavigating = false; }, 600);
    }
    function goBack(){ 
      if (!throttle() || isNavigating) return; 
      unlockAudioContext(); 
      isNavigating = true;
      startPage(currentPage-1);
      setTimeout(() => { isNavigating = false; }, 600);
    }

    // Use only click events to avoid double-firing
    document.getElementById('nav-prev').addEventListener('click', goBack);
    document.getElementById('nav-next').addEventListener('click', safeAdvance);
document.addEventListener('click', (e)=>{ 
      if (e.target.id==='nav-prev'||e.target.id==='nav-next') return; 
      
      // Ignore clicks on video player and controls (for trailer on slide 7 only)
      // Only ignore video container clicks if we're on slide 7 (trailer with controls)
      if (currentPage === 6) { // Slide 7 - trailer with video controls
        if (e.target.tagName === 'VIDEO' || 
            e.target.closest('video') ||
            e.target.closest('#video-container') ||
            e.target.closest('.video-container') ||
            e.target.classList.contains('video-controls') ||
            e.target.closest('.video-controls')) {
          return; // Let video controls handle the click on slide 7 only
        }
      }
      
      // Don't navigate if already navigating
      if (isNavigating) return;
      
      // Timeline reveal mode removed
      
      // If in line reveal mode, clicking anywhere advances to next line
      if (isInLineRevealMode) {
        e.preventDefault(); // Prevent any default click behavior
        showNextLineManual();
        return;
      }
      
      // Normal mode: Left half of screen goes back, right half goes forward
      if (e.clientX < window.innerWidth / 2) {
        goBack();
      } else {
        safeAdvance();
      }
    });

    // Font system - Crisp only
    let currentFontIndex = 0; // Start with Crisp (index 0) as default
    let currentFontSize = 1.0; // Size multiplier (1.0 = 100% of base size)
    const fonts = [
      { family: 'Crisp, "Courier New", monospace', size: '1.2rem' }
    ];
    
    function cycleFontForward() {
      // Only one font available, no cycling needed
      applyCurrentFont();
    }
    
    function cycleFontBackward() {
      // Only one font available, no cycling needed
      applyCurrentFont();
    }
    
             function applyCurrentFont() {
      const selectedFont = fonts[currentFontIndex];
      console.log('Applying font:', selectedFont);
      
      // Update the CSS custom property
      document.documentElement.style.setProperty('--font-family', selectedFont.family);
      
      // Apply font family to all text elements
      const allTextElements = document.querySelectorAll('#unscramble, #prompt, #nav-msg, #nav-prev, #nav-next, #slide-counter');
      allTextElements.forEach(el => {
        if (el) {
          el.style.fontFamily = selectedFont.family;
        }
      });
      
      // Also apply to body to ensure all elements inherit the font
      document.body.style.fontFamily = selectedFont.family;
      
      console.log(`Font changed to: ${selectedFont.family}`);
    }

    window.addEventListener('keydown', (e) => {
      // Mute any keyboard sounds
      e.preventDefault();
      
      // Timeline reveal mode removed
      
      // Check if we're in line reveal mode
      if (isInLineRevealMode && (e.code==='Space'||e.code==='ArrowRight')) {
        showNextLineManual();
        return;
      }
      
      if (e.code==='Space'||e.code==='ArrowRight'){ unlockAudioContext(); startPage(currentPage+1); }
      else if (e.code==='ArrowLeft'){ unlockAudioContext(); startPage(currentPage-1); }

      const k = e.key;
      if (k==='z'||k==='Z'){ toggleGreenOverlay('full'); }
      else if (k==='x'||k==='X'){ toggleGreenOverlay('half'); }
      else if (k==='c'||k==='C'){ toggleGreenOverlay('off'); }
      else if (k==='f'||k==='F'){ toggleFullscreen(); }
      // Audio test key removed - defunct
      // video2 keyboard shortcuts removed - defunct
    });
    
    // Fullscreen functionality
    function toggleFullscreen() {
      if (!document.fullscreenElement) {
document.documentElement.requestFullscreen().catch(err => {
  console.log(`Error attempting to enable fullscreen: ${err.message}`);
});
      } else {
document.exitFullscreen();
      }
    }

    /* ================== COLOR/GLOW ================== */
    (function(){
      const navPrev = document.getElementById('nav-prev');
      const navNext = document.getElementById('nav-next');
      const terminals = [document.getElementById('unscramble'), document.getElementById('prompt'), document.getElementById('nav-msg'), navPrev, navNext, document.getElementById('slide-counter')];
      let colorIndex=1; // Default to bright green (option 2)
      const colors=['#CCCCCC','#00DD00','#66FF66'];
      function apply(){
terminals.forEach(el=>{ if(!el) return;
  el.style.color = colors[colorIndex];
  el.style.textShadow = `0 0 2px ${colors[colorIndex]}, 0 0 8px ${colors[colorIndex]}, 0 0 16px ${colors[colorIndex]}`; // Enhanced glow with 3 layers
  el.style.filter = 'saturate(1.3)'; // Increase saturation
  el.style.webkitFilter = 'saturate(1.3)';
});

// Update cursor color to match
const customCursor = document.getElementById('custom-cursor');
if (customCursor) {
  customCursor.style.background = colors[colorIndex];
  customCursor.style.boxShadow = `0 0 2px ${colors[colorIndex]}, 0 0 8px ${colors[colorIndex]}, 0 0 16px ${colors[colorIndex]}`;
}
      }
      document.addEventListener('keydown', (e)=>{
if (e.key==='1'||e.key==='2'||e.key==='3'){ colorIndex=parseInt(e.key,10)-1; apply(); }
      });
      apply();
    })();

    /* ================== MOBILE TIMELINE HANDLER ================== */
    // Dedicated mobile handler for timeline reveal - works on all mobile devices
    // Mobile timeline handler removed

    /* ================== INIT ================== */
    window.onload = () => {
      // Start presentation immediately when DOM is loaded
      startPage(0);
      
      // Mobile timeline handler removed
      
      // Initialize audio context for mobile devices
      if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
        console.log('📱 Mobile device detected - preparing audio context');
        // Pre-initialize audio context on mobile
        initAudioContext();
      }
      
      // Mute all audio by default
      document.addEventListener('keydown', (e) => {
        e.preventDefault();
      });
      
      // Mute all audio elements by default
      document.querySelectorAll('audio, video').forEach(media => {
        media.muted = true;
        media.volume = 0;
      });
      
      // Video will only show on page 15 via the page navigation logic
      // Hide any images that fail to load
      document.querySelectorAll('#page img').forEach(img => {
img.addEventListener('error', () => {
  img.style.display = 'none';
});
      });
      
      // Custom cursor functionality
      const customCursor = document.getElementById('custom-cursor');
      
      document.addEventListener('mousemove', (e) => {
customCursor.style.display = 'block';
customCursor.style.left = e.clientX - 10 + 'px';
customCursor.style.top = e.clientY - 10 + 'px';
      });
      
      document.addEventListener('mouseleave', () => {
customCursor.style.display = 'none';
      });
      
      // Apply the default font (Crisp) on page load
      applyCurrentFont();
    };
    
    // Mobile text wrapping function
    function wrapTextForMobile(text) {
      // For now, just return the text as-is since we don't need special mobile wrapping
      return text;
    }
    
    // Global green overlay toggle function
    let currentOverlayMode = 'full'; // Track current overlay mode - default to full green
    
    function toggleGreenOverlay(mode) {
      currentOverlayMode = mode; // Store the current mode
      const images = document.querySelectorAll('#page img');
      images.forEach(img => {
applyOverlayToImage(img, mode);
      });
      
    }
    
       // Apply overlay to a specific image
      function applyOverlayToImage(img, mode) {
// Check if this is photo23 (which should stay dimmed) or page 10 images (which should be darker)
const isDimmedPhoto = img.id === 'img-23';
const isDarkerPhoto = img.id.startsWith('img-10');
const baseBrightness = isDarkerPhoto ? 0.5 : (isDimmedPhoto ? 0.5 : 0.8);

if (mode === 'full') {
  img.style.filter = `grayscale(1) brightness(${baseBrightness}) contrast(1.2) sepia(1) hue-rotate(60deg) saturate(4)`;
} else if (mode === 'half') {
  img.style.filter = `brightness(${baseBrightness}) grayscale(1)`;
} else if (mode === 'off') {
  img.style.filter = `brightness(${baseBrightness})`;
}
      }
    
     
     
  </script>
  
  
  
</body>
</html>
  